import{_ as H}from"./preload-helper.C1FmrZbK.js";import{a as I,e as T,b as D,n as v,d as R,c as w,A as z,g as N,j,k as C,u as q,C as d,f as B}from"./scheduler.BGjPv-1J.js";import{S as F,i as G}from"./index.DGGgQIon.js";import{c as K,f as W}from"./Loader.DbTsSYa5.js";function M(a){let t;return{c(){t=N("video"),this.h()},l(e){t=j(e,"VIDEO",{class:!0}),C(t).forEach(R),this.h()},h(){t.muted=a[3],t.controls=a[4],q(t,"class","svelte-1xeckxu"),d(t,"display",a[6]?"none":"initial"),d(t,"width",a[2]?"100%":"calc(14.5rem * 2 + 0.4rem)"),d(t,"object-fit",a[1])},m(e,n){D(e,t,n),a[12](t)},p(e,n){n&8&&(t.muted=e[3]),n&16&&(t.controls=e[4]),n&64&&d(t,"display",e[6]?"none":"initial"),n&4&&d(t,"width",e[2]?"100%":"calc(14.5rem * 2 + 0.4rem)"),n&2&&d(t,"object-fit",e[1])},d(e){e&&R(t),a[12](null)}}}function Y(a){let t,e=a[0]&&M(a);return{c(){e&&e.c(),t=T()},l(n){e&&e.l(n),t=T()},m(n,c){e&&e.m(n,c),D(n,t,c)},p(n,[c]){n[0]?e?e.p(n,c):(e=M(n),e.c(),e.m(t.parentNode,t)):e&&(e.d(1),e=null)},i:v,o:v,d(n){n&&R(t),e&&e.d(n)}}}function J(a,t,e){let n,c;w(a,K,i=>e(15,n=i)),w(a,W,i=>e(6,c=i));let{sel:s}=t,{entity:u}=t,{stream_url:l}=t,{size:k}=t,{loaderVisible:_}=t,{responsive:L=void 0}=t,{muted:S=!0}=t,{controls:V=!1}=t,{debug:m}=t,{attachVideo:y}=t,o,r,b=!1;const h=()=>r.play();async function P(){if(!(l||b)){b=!0;try{const i=await(n==null?void 0:n.sendMessagePromise({type:"camera/stream",entity_id:u==null?void 0:u.entity_id}));if(e(0,l=i.url),!l)return;const{default:f}=await H(async()=>{const{default:E}=await import("./hls.B_HYICW5.js");return{default:E}},[],import.meta.url);if(f.isSupported()){const E={backBufferLength:60,fragLoadingTimeOut:3e4,manifestLoadingTimeOut:3e4,levelLoadingTimeOut:3e4,maxLiveSyncPlaybackRate:2,lowLatencyMode:!0};o||(o=new f(E)),o.loadSource(l),o.attachMedia(r),o.on(f.Events.MANIFEST_PARSED,()=>{m&&console.debug("HLS attached:",s==null?void 0:s.entity_id),e(7,_=!1),h()}),o.on(f.Events.DESTROYING,()=>{m&&console.debug("HLS detached:",s==null?void 0:s.entity_id)}),o.on(f.Events.ERROR,(Q,g)=>{if(g.fatal)switch(g.type){case f.ErrorTypes.MEDIA_ERROR:console.error("fatal media error encountered, try to recover"),o==null||o.recoverMediaError();break;case f.ErrorTypes.NETWORK_ERROR:console.error("fatal network error encountered",g);break;default:o==null||o.destroy();break}})}else r.canPlayType("application/vnd.apple.mpegurl")&&(e(5,r.src=l,r),r.addEventListener("loadedmetadata",h))}catch(i){(i==null?void 0:i.code)==="start_stream_failed"||console.error(i)}finally{b=!1}}}function O(){o==null||o.destroy(),o=void 0,e(0,l=void 0),r&&(r.removeEventListener("loadedmetadata",h),e(5,r.src="",r),r.load())}z(()=>O());function A(i){B[i?"unshift":"push"](()=>{r=i,e(5,r)})}return a.$$set=i=>{"sel"in i&&e(8,s=i.sel),"entity"in i&&e(9,u=i.entity),"stream_url"in i&&e(0,l=i.stream_url),"size"in i&&e(1,k=i.size),"loaderVisible"in i&&e(7,_=i.loaderVisible),"responsive"in i&&e(2,L=i.responsive),"muted"in i&&e(3,S=i.muted),"controls"in i&&e(4,V=i.controls),"debug"in i&&e(10,m=i.debug),"attachVideo"in i&&e(11,y=i.attachVideo)},a.$$.update=()=>{a.$$.dirty&2048&&(y?P():O())},[l,k,L,S,V,r,c,_,s,u,m,y,A]}class p extends F{constructor(t){super(),G(this,t,J,Y,I,{sel:8,entity:9,stream_url:0,size:1,loaderVisible:7,responsive:2,muted:3,controls:4,debug:10,attachVideo:11})}}export{p as default};
