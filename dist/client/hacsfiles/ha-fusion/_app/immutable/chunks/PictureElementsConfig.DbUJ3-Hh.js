var oi=Object.defineProperty;var ci=(n,s,e)=>s in n?oi(n,s,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[s]=e;var fe=(n,s,e)=>ci(n,typeof s!="symbol"?s+"":s,e);import{a as Ge,g as T,h as K,j as S,k as z,m as Z,d as m,u as g,b as V,o as $,w as x,y as je,r as Oe,c as He,t as Me,l as De,p as Qe,n as we,v as _e,C as Re,i as ht,e as Ue,D as We,ae as At,H as gt,I as pt,F as Ye,af as xe,J as yt,z as Tt,B as ot,x as ri,N as ui,M as St,A as di,U as nt,f as Ke,q as dt}from"./scheduler.BGjPv-1J.js";import{S as Ve,i as Fe,b as ee,d as te,m as ie,t as U,g as Be,c as ze,a as F,e as se,j as Ze,f as ft}from"./index.DGGgQIon.js";import{e as Te,$ as Xe,V as Je,y as mt,a0 as Nt,s as kt,c as fi,L as Ct,B as hi,C as gi,Y as ct,T as Ot,U as mi,E as Mt,p as pi,h as bi,i as Dt,l as _i,J as at,K as rt}from"./Loader.DbTsSYa5.js";import{I as oe,v as le,c as vi,f as yi,e as ki,h as wi,i as Ei,k as $i,w as Ii,x as Bt,y as Ai}from"./2.dCG7GHcU.js";import{K as Ti,a as Q}from"./konvaBase.AJaH1g0x.js";import{s as Si}from"./services.DaJBgRL-.js";import{d as Ni}from"./index.DqLi_Cxs.js";import{I as Ci}from"./Index.CWVzh7Hi.js";import{C as Oi}from"./ConfigButtons.Cc1o6-ot.js";function zt(n,s,e){const t=n.slice();return t[14]=s[e],t}function Mi(n){var k;let s,e=((k=n[14])==null?void 0:k.label)+"",t,l,r,i,o,a,c,u,d,h;function p(...f){return n[9](n[14],...f)}return{c(){s=T("label"),t=Me(e),l=Me(":"),i=K(),o=T("input"),this.h()},l(f){s=S(f,"LABEL",{for:!0});var b=z(s);t=De(b,e),l=De(b,":"),b.forEach(m),i=Z(f),o=S(f,"INPUT",{type:!0,id:!0}),this.h()},h(){var f,b,_,E,G;g(s,"for",r=(f=n[14])==null?void 0:f.id),g(o,"type","text"),g(o,"id",a=(b=n[14])==null?void 0:b.id),o.value=c=`${((_=n[14])==null?void 0:_.value)??""}${((E=n[14])==null?void 0:E.unit)||""}`,o.disabled=u=(G=n[14])==null?void 0:G.disabled},m(f,b){V(f,s,b),$(s,t),$(s,l),V(f,i,b),V(f,o,b),d||(h=x(o,"change",p),d=!0)},p(f,b){var _,E,G,C,H,N;n=f,b&16&&e!==(e=((_=n[14])==null?void 0:_.label)+"")&&Qe(t,e),b&16&&r!==(r=(E=n[14])==null?void 0:E.id)&&g(s,"for",r),b&16&&a!==(a=(G=n[14])==null?void 0:G.id)&&g(o,"id",a),b&16&&c!==(c=`${((C=n[14])==null?void 0:C.value)??""}${((H=n[14])==null?void 0:H.unit)||""}`)&&o.value!==c&&(o.value=c),b&16&&u!==(u=(N=n[14])==null?void 0:N.disabled)&&(o.disabled=u)},i:we,o:we,d(f){f&&(m(s),m(i),m(o)),d=!1,h()}}}function Di(n){var a;let s,e,t,l,r,i,o;return e=new oe({props:{icon:(a=n[14])==null?void 0:a.icon,width:"15",height:"15"}}),{c(){s=T("button"),ee(e.$$.fragment),this.h()},l(c){s=S(c,"BUTTON",{title:!0,class:!0});var u=z(s);te(e.$$.fragment,u),u.forEach(m),this.h()},h(){var c,u,d,h,p,k,f,b;s.disabled=t=((c=n[3])==null?void 0:c.length)<1&&!((d=(u=n[2])==null?void 0:u.attrs)!=null&&d.draggable),g(s,"title",l=(h=n[14])==null?void 0:h.label),g(s,"class","svelte-68wg8f"),_e(s,"selected",(p=n[14])==null?void 0:p.selected),Re(s,"opacity",((k=n[3])==null?void 0:k.length)>0&&((b=(f=n[2])==null?void 0:f.attrs)!=null&&b.draggable)?"1":"0.5")},m(c,u){V(c,s,u),ie(e,s,null),r=!0,i||(o=[x(s,"click",function(){var d,h;ht((d=n[14])==null?void 0:d.onclick)&&((h=n[14])==null||h.onclick.apply(this,arguments))}),x(s,"dblclick",function(){var d,h;ht((d=n[14])==null?void 0:d.ondblclick)&&((h=n[14])==null||h.ondblclick.apply(this,arguments))})],i=!0)},p(c,u){var h,p,k,f,b,_,E,G,C;n=c;const d={};u&16&&(d.icon=(h=n[14])==null?void 0:h.icon),e.$set(d),(!r||u&12&&t!==(t=((p=n[3])==null?void 0:p.length)<1&&!((f=(k=n[2])==null?void 0:k.attrs)!=null&&f.draggable)))&&(s.disabled=t),(!r||u&16&&l!==(l=(b=n[14])==null?void 0:b.label))&&g(s,"title",l),(!r||u&16)&&_e(s,"selected",(_=n[14])==null?void 0:_.selected),u&12&&Re(s,"opacity",((E=n[3])==null?void 0:E.length)>0&&((C=(G=n[2])==null?void 0:G.attrs)!=null&&C.draggable)?"1":"0.5")},i(c){r||(U(e.$$.fragment,c),r=!0)},o(c){F(e.$$.fragment,c),r=!1},d(c){c&&m(s),se(e),i=!1,Oe(o)}}}function Ht(n){let s,e,t,l;const r=[Di,Mi],i=[];function o(a,c){return a[14].type==="button"?0:1}return e=o(n),t=i[e]=r[e](n),{c(){s=T("div"),t.c(),this.h()},l(a){s=S(a,"DIV",{class:!0});var c=z(s);t.l(c),c.forEach(m),this.h()},h(){g(s,"class","konva-attribute")},m(a,c){V(a,s,c),i[e].m(s,null),l=!0},p(a,c){let u=e;e=o(a),e===u?i[e].p(a,c):(Be(),F(i[u],1,1,()=>{i[u]=null}),ze(),t=i[e],t?t.p(a,c):(t=i[e]=r[e](a),t.c()),U(t,1),t.m(s,null))},i(a){l||(U(t),l=!0)},o(a){F(t),l=!1},d(a){a&&m(s),i[e].d()}}}function Bi(n){var C,H,N;let s,e,t,l,r,i,o,a,c,u,d,h,p,k,f,b,_=Te(n[4]),E=[];for(let w=0;w<_.length;w+=1)E[w]=Ht(zt(n,_,w));const G=w=>F(E[w],1,1,()=>{E[w]=null});return r=new oe({props:{icon:(C=le)==null?void 0:C.undo}}),c=new oe({props:{icon:(H=le)==null?void 0:H.redo}}),p=new oe({props:{icon:(N=le)==null?void 0:N.help}}),{c(){s=T("div");for(let w=0;w<E.length;w+=1)E[w].c();e=K(),t=T("div"),l=T("button"),ee(r.$$.fragment),o=K(),a=T("button"),ee(c.$$.fragment),d=K(),h=T("button"),ee(p.$$.fragment),this.h()},l(w){s=S(w,"DIV",{class:!0});var O=z(s);for(let y=0;y<E.length;y+=1)E[y].l(O);e=Z(O),t=S(O,"DIV",{class:!0});var M=z(t);l=S(M,"BUTTON",{title:!0,class:!0});var L=z(l);te(r.$$.fragment,L),L.forEach(m),o=Z(M),a=S(M,"BUTTON",{title:!0,class:!0});var Y=z(a);te(c.$$.fragment,Y),Y.forEach(m),d=Z(M),h=S(M,"BUTTON",{title:!0,class:!0});var j=z(h);te(p.$$.fragment,j),j.forEach(m),M.forEach(m),O.forEach(m),this.h()},h(){var w,O,M,L;g(l,"title","Undo"),l.disabled=i=!(((O=(w=n[5])==null?void 0:w.undoStack)==null?void 0:O.length)>1),g(l,"class","svelte-68wg8f"),g(a,"title","Redo"),a.disabled=u=!(((L=(M=n[5])==null?void 0:M.redoStack)==null?void 0:L.length)>0),g(a,"class","svelte-68wg8f"),g(h,"title","Help"),g(h,"class","svelte-68wg8f"),g(t,"class","history svelte-68wg8f"),g(s,"class","konva-attribute-section")},m(w,O){V(w,s,O);for(let M=0;M<E.length;M+=1)E[M]&&E[M].m(s,null);$(s,e),$(s,t),$(t,l),ie(r,l,null),$(t,o),$(t,a),ie(c,a,null),$(t,d),$(t,h),ie(p,h,null),k=!0,f||(b=[x(l,"click",n[10]),x(a,"click",n[11]),x(h,"click",n[12])],f=!0)},p(w,[O]){var M,L,Y,j;if(O&92){_=Te(w[4]);let y;for(y=0;y<_.length;y+=1){const P=zt(w,_,y);E[y]?(E[y].p(P,O),U(E[y],1)):(E[y]=Ht(P),E[y].c(),U(E[y],1),E[y].m(s,e))}for(Be(),y=_.length;y<E.length;y+=1)G(y);ze()}(!k||O&32&&i!==(i=!(((L=(M=w[5])==null?void 0:M.undoStack)==null?void 0:L.length)>1)))&&(l.disabled=i),(!k||O&32&&u!==(u=!(((j=(Y=w[5])==null?void 0:Y.redoStack)==null?void 0:j.length)>0)))&&(a.disabled=u)},i(w){if(!k){for(let O=0;O<_.length;O+=1)U(E[O]);U(r.$$.fragment,w),U(c.$$.fragment,w),U(p.$$.fragment,w),k=!0}},o(w){E=E.filter(Boolean);for(let O=0;O<E.length;O+=1)F(E[O]);F(r.$$.fragment,w),F(c.$$.fragment,w),F(p.$$.fragment,w),k=!1},d(w){w&&m(s),je(E,w),se(r),se(c),se(p),f=!1,Oe(b)}}}function zi(n,s,e){let t,l;He(n,Xe,_=>e(5,l=_));let{konva:r}=s,{selectedShape:i}=s,{selectedShapes:o}=s,{setAttribute:a}=s,{showHelp:c}=s,u=[];function d(_,E){const G=E.target;if(_.id==="scaleX"||_.id==="scaleY")h(E,_.id);else{const C=parseFloat(G.value);isNaN(C)||a(i.attrs.id,_.id,E)}}function h(_,E){const C=_.target.value.replace(/%$/,""),H=parseFloat(C)/100;r.updateAttr(i.attrs.id,E,H)}const p=(_,E)=>d(_,E),k=()=>r.undo(),f=()=>r.redo(),b=()=>e(0,c=!0);return n.$$set=_=>{"konva"in _&&e(1,r=_.konva),"selectedShape"in _&&e(2,i=_.selectedShape),"selectedShapes"in _&&e(3,o=_.selectedShapes),"setAttribute"in _&&e(7,a=_.setAttribute),"showHelp"in _&&e(0,c=_.showHelp)},n.$$.update=()=>{var _,E,G,C,H,N,w,O,M,L,Y,j,y,P,D,I,v,A,R,W,q,ce,ae,de,ge,me;n.$$.dirty&2&&e(8,t={id:"keepRatio",type:"button",label:"Ratio (R)",icon:le.chain,onclick:()=>{var ye;r==null||r.toggleKeepRatio(),e(8,t.selected=((ye=r==null?void 0:r.transformer)==null?void 0:ye.keepRatio())||!1,t)},selected:((_=r==null?void 0:r.transformer)==null?void 0:_.keepRatio())||!1}),n.$$.dirty&268&&((o==null?void 0:o.length)===1&&((E=i==null?void 0:i.attrs)!=null&&E.box)?e(4,u=[{id:"x",label:"X",unit:" px",value:Math.round((G=i==null?void 0:i.attrs)==null?void 0:G.x)||0,disabled:!((C=i==null?void 0:i.attrs)!=null&&C.draggable)},{id:"y",label:"Y",unit:" px",value:Math.round((H=i==null?void 0:i.attrs)==null?void 0:H.y)||0,disabled:!((N=i==null?void 0:i.attrs)!=null&&N.draggable)},{id:"width",label:"Width",unit:" px",value:Math.round((w=i==null?void 0:i.attrs)==null?void 0:w.width),disabled:!((O=i==null?void 0:i.attrs)!=null&&O.draggable)},{...t},{id:"height",label:"Height",unit:" px",value:Math.round((M=i==null?void 0:i.attrs)==null?void 0:M.height),disabled:!((L=i==null?void 0:i.attrs)!=null&&L.draggable)},{id:"rotation",label:"Rotation",unit:"°",value:(Y=i==null?void 0:i.attrs)!=null&&Y.rotation?Number.parseFloat((j=i==null?void 0:i.attrs)==null?void 0:j.rotation).toFixed(1):0,disabled:!((y=i==null?void 0:i.attrs)!=null&&y.draggable)}]):(o==null?void 0:o.length)===1&&!((D=(P=i==null?void 0:i.attrs)==null?void 0:P.type)!=null&&D.includes("-guide"))?e(4,u=[{id:"x",label:"X",unit:" px",value:Math.round((I=i==null?void 0:i.attrs)==null?void 0:I.x)||0,disabled:!((v=i==null?void 0:i.attrs)!=null&&v.draggable)},{id:"y",label:"Y",unit:" px",value:Math.round((A=i==null?void 0:i.attrs)==null?void 0:A.y)||0,disabled:!((R=i==null?void 0:i.attrs)!=null&&R.draggable)},{id:"scaleX",label:"Width",unit:"%",value:Math.round(((W=i==null?void 0:i.attrs)==null?void 0:W.scaleX)*100)||100,handler:h,disabled:!((q=i==null?void 0:i.attrs)!=null&&q.draggable)},{...t},{id:"scaleY",label:"Height",unit:"%",value:Math.round(((ce=i==null?void 0:i.attrs)==null?void 0:ce.scaleY)*100)||100,handler:h,disabled:!((ae=i==null?void 0:i.attrs)!=null&&ae.draggable)},{id:"rotation",label:"Rotation",unit:"°",value:(de=i==null?void 0:i.attrs)!=null&&de.rotation?Number.parseFloat((ge=i==null?void 0:i.attrs)==null?void 0:ge.rotation).toFixed(1):0,disabled:!((me=i==null?void 0:i.attrs)!=null&&me.draggable)}]):e(4,u=[{id:"x",label:"X",unit:" px",value:0,disabled:!0},{id:"y",label:"Y",unit:" px",value:0,disabled:!0},{id:"width",label:"Width",unit:" px",value:0,disabled:!0},{...t},{id:"height",label:"Height",unit:" px",value:0,disabled:!0},{id:"rotation",label:"Rotation",unit:"°",value:0,disabled:!0}]))},[c,r,i,o,u,l,d,a,t,p,k,f,b]}class Hi extends Ve{constructor(s){super(),Fe(this,s,zi,Bi,Ge,{konva:1,selectedShape:2,selectedShapes:3,setAttribute:7,showHelp:0})}}function Lt(n,s,e){const t=n.slice();return t[12]=s[e],t}function Pt(n,s,e){const t=n.slice();return t[15]=s[e],t}function Li(n){var a,c;let s,e,t,l=((a=n[1])==null?void 0:a.length)+"",r,i,o;return e=new oe({props:{icon:(c=le)==null?void 0:c.shapes,width:"20",height:"20"}}),{c(){s=T("span"),ee(e.$$.fragment),t=K(),r=Me(l),i=Me(" elements selected"),this.h()},l(u){s=S(u,"SPAN",{class:!0});var d=z(s);te(e.$$.fragment,d),d.forEach(m),t=Z(u),r=De(u,l),i=De(u," elements selected"),this.h()},h(){g(s,"class","icon svelte-174212j")},m(u,d){V(u,s,d),ie(e,s,null),V(u,t,d),V(u,r,d),V(u,i,d),o=!0},p(u,d){var h;(!o||d&2)&&l!==(l=((h=u[1])==null?void 0:h.length)+"")&&Qe(r,l)},i(u){o||(U(e.$$.fragment,u),o=!0)},o(u){F(e.$$.fragment,u),o=!1},d(u){u&&(m(s),m(t),m(r),m(i)),se(e)}}}function Pi(n){let s,e,t,l;const r=[Gi,Ui],i=[];function o(a,c){var u,d;return((d=(u=a[0])==null?void 0:u.attrs)==null?void 0:d.type)==="group"?0:1}return s=o(n),e=i[s]=r[s](n),{c(){e.c(),t=Ue()},l(a){e.l(a),t=Ue()},m(a,c){i[s].m(a,c),V(a,t,c),l=!0},p(a,c){let u=s;s=o(a),s===u?i[s].p(a,c):(Be(),F(i[u],1,1,()=>{i[u]=null}),ze(),e=i[s],e?e.p(a,c):(e=i[s]=r[s](a),e.c()),U(e,1),e.m(t.parentNode,t))},i(a){l||(U(e),l=!0)},o(a){F(e),l=!1},d(a){a&&m(t),i[s].d(a)}}}function Ri(n){var r;let s,e,t,l;return e=new oe({props:{icon:(r=le)==null?void 0:r.tip,width:"20",height:"17"}}),{c(){s=T("span"),ee(e.$$.fragment),t=Me(`\r
		Click an element to select it`),this.h()},l(i){s=S(i,"SPAN",{class:!0});var o=z(s);te(e.$$.fragment,o),o.forEach(m),t=De(i,`\r
		Click an element to select it`),this.h()},h(){g(s,"class","icon svelte-174212j")},m(i,o){V(i,s,o),ie(e,s,null),V(i,t,o),l=!0},p:we,i(i){l||(U(e.$$.fragment,i),l=!0)},o(i){F(e.$$.fragment,i),l=!1},d(i){i&&(m(s),m(t)),se(e)}}}function Ui(n){var h,p,k;let s,e,t,l,r,i;e=new oe({props:{icon:(k=le)==null?void 0:k[(p=(h=n[0])==null?void 0:h.attrs)==null?void 0:p.type],width:"20",height:"20"}});let o=Te(n[4]),a=[];for(let f=0;f<o.length;f+=1)a[f]=Rt(Pt(n,o,f));const c=f=>F(a[f],1,1,()=>{a[f]=null});let u=Te(n[3]),d=[];for(let f=0;f<u.length;f+=1)d[f]=Ut(Lt(n,u,f));return{c(){s=T("span"),ee(e.$$.fragment),t=K();for(let f=0;f<a.length;f+=1)a[f].c();l=K(),r=T("datalist");for(let f=0;f<d.length;f+=1)d[f].c();this.h()},l(f){s=S(f,"SPAN",{class:!0});var b=z(s);te(e.$$.fragment,b),b.forEach(m),t=Z(f);for(let E=0;E<a.length;E+=1)a[E].l(f);l=Z(f),r=S(f,"DATALIST",{id:!0});var _=z(r);for(let E=0;E<d.length;E+=1)d[E].l(_);_.forEach(m),this.h()},h(){g(s,"class","icon svelte-174212j"),g(r,"id","entityOptions")},m(f,b){V(f,s,b),ie(e,s,null),V(f,t,b);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(f,b);V(f,l,b),V(f,r,b);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(r,null);i=!0},p(f,b){var E,G,C;const _={};if(b&1&&(_.icon=(C=le)==null?void 0:C[(G=(E=f[0])==null?void 0:E.attrs)==null?void 0:G.type]),e.$set(_),b&53){o=Te(f[4]);let H;for(H=0;H<o.length;H+=1){const N=Pt(f,o,H);a[H]?(a[H].p(N,b),U(a[H],1)):(a[H]=Rt(N),a[H].c(),U(a[H],1),a[H].m(l.parentNode,l))}for(Be(),H=o.length;H<a.length;H+=1)c(H);ze()}if(b&8){u=Te(f[3]);let H;for(H=0;H<u.length;H+=1){const N=Lt(f,u,H);d[H]?d[H].p(N,b):(d[H]=Ut(N),d[H].c(),d[H].m(r,null))}for(;H<d.length;H+=1)d[H].d(1);d.length=u.length}},i(f){if(!i){U(e.$$.fragment,f);for(let b=0;b<o.length;b+=1)U(a[b]);i=!0}},o(f){F(e.$$.fragment,f),a=a.filter(Boolean);for(let b=0;b<a.length;b+=1)F(a[b]);i=!1},d(f){f&&(m(s),m(t),m(l),m(r)),se(e),je(a,f),je(d,f)}}}function Gi(n){var a;let s,e,t,l=_t(n[0])+"",r,i,o;return e=new oe({props:{icon:(a=le)==null?void 0:a.group,width:"20",height:"20"}}),{c(){s=T("span"),ee(e.$$.fragment),t=Me(`\r
			Group (`),r=Me(l),i=Me(" elements)"),this.h()},l(c){s=S(c,"SPAN",{class:!0});var u=z(s);te(e.$$.fragment,u),u.forEach(m),t=De(c,`\r
			Group (`),r=De(c,l),i=De(c," elements)"),this.h()},h(){g(s,"class","icon svelte-174212j")},m(c,u){V(c,s,u),ie(e,s,null),V(c,t,u),V(c,r,u),V(c,i,u),o=!0},p(c,u){(!o||u&1)&&l!==(l=_t(c[0])+"")&&Qe(r,l)},i(c){o||(U(e.$$.fragment,c),o=!0)},o(c){F(e.$$.fragment,c),o=!1},d(c){c&&(m(s),m(t),m(r),m(i)),se(e)}}}function Vi(n){let s,e,t,l,r,i,o,a,c;function u(...d){return n[11](n[15],...d)}return{c(){s=T("input"),this.h()},l(d){s=S(d,"INPUT",{id:!0,class:!0,type:!0,list:!0}),this.h()},h(){var d,h,p,k,f,b,_,E;g(s,"id",e=(d=n[15])==null?void 0:d.id),g(s,"class",t=At((h=n[15])==null?void 0:h.className)+" svelte-174212j"),g(s,"type",l=(p=n[15])==null?void 0:p.type),g(s,"list",r=(k=n[15])==null?void 0:k.list),s.value=i=`${((f=n[15])==null?void 0:f.value)??"0"}${((b=n[15])==null?void 0:b.unit)||""}`,s.disabled=o=(_=n[15])==null?void 0:_.disabled,Re(s,"width",(E=n[15])==null?void 0:E.width)},m(d,h){V(d,s,h),a||(c=x(s,"change",u),a=!0)},p(d,h){var p,k,f,b,_,E,G,C;n=d,h&16&&e!==(e=(p=n[15])==null?void 0:p.id)&&g(s,"id",e),h&16&&t!==(t=At((k=n[15])==null?void 0:k.className)+" svelte-174212j")&&g(s,"class",t),h&16&&l!==(l=(f=n[15])==null?void 0:f.type)&&g(s,"type",l),h&16&&r!==(r=(b=n[15])==null?void 0:b.list)&&g(s,"list",r),h&16&&i!==(i=`${((_=n[15])==null?void 0:_.value)??"0"}${((E=n[15])==null?void 0:E.unit)||""}`)&&s.value!==i&&(s.value=i),h&16&&o!==(o=(G=n[15])==null?void 0:G.disabled)&&(s.disabled=o),h&16&&Re(s,"width",(C=n[15])==null?void 0:C.width)},i:we,o:we,d(d){d&&m(s),a=!1,c()}}}function Fi(n){let s,e,t,l,r,i,o;function a(...u){return n[9](n[15],...u)}function c(...u){return n[10](n[15],...u)}return{c(){s=T("input"),this.h()},l(u){s=S(u,"INPUT",{id:!0,type:!0,class:!0}),this.h()},h(){var u,d,h,p,k;g(s,"id",e=(u=n[15])==null?void 0:u.id),g(s,"type",t=(d=n[15])==null?void 0:d.type),s.value=l=(h=n[15])==null?void 0:h.value,s.disabled=r=(p=n[15])==null?void 0:p.disabled,g(s,"class","svelte-174212j"),Re(s,"width",(k=n[15])==null?void 0:k.width)},m(u,d){V(u,s,d),i||(o=[x(s,"change",a),x(s,"input",c)],i=!0)},p(u,d){var h,p,k,f,b;n=u,d&16&&e!==(e=(h=n[15])==null?void 0:h.id)&&g(s,"id",e),d&16&&t!==(t=(p=n[15])==null?void 0:p.type)&&g(s,"type",t),d&16&&l!==(l=(k=n[15])==null?void 0:k.value)&&s.value!==l&&(s.value=l),d&16&&r!==(r=(f=n[15])==null?void 0:f.disabled)&&(s.disabled=r),d&16&&Re(s,"width",(b=n[15])==null?void 0:b.width)},i:we,o:we,d(u){u&&m(s),i=!1,Oe(o)}}}function ji(n){var a;let s,e,t,l,r,i,o;return e=new oe({props:{icon:(a=n[15])==null?void 0:a.icon,width:"20",height:"20"}}),{c(){s=T("button"),ee(e.$$.fragment),this.h()},l(c){s=S(c,"BUTTON",{id:!0,class:!0});var u=z(s);te(e.$$.fragment,u),u.forEach(m),this.h()},h(){var c,u,d;g(s,"id",t=(c=n[15])==null?void 0:c.id),s.disabled=l=(u=n[15])==null?void 0:u.disabled,g(s,"class","svelte-174212j"),_e(s,"selected",(d=n[15])==null?void 0:d.selected)},m(c,u){V(c,s,u),ie(e,s,null),r=!0,i||(o=x(s,"click",function(){var d,h;ht((d=n[15])==null?void 0:d.onclick)&&((h=n[15])==null||h.onclick.apply(this,arguments))}),i=!0)},p(c,u){var h,p,k,f;n=c;const d={};u&16&&(d.icon=(h=n[15])==null?void 0:h.icon),e.$set(d),(!r||u&16&&t!==(t=(p=n[15])==null?void 0:p.id))&&g(s,"id",t),(!r||u&16&&l!==(l=(k=n[15])==null?void 0:k.disabled))&&(s.disabled=l),(!r||u&16)&&_e(s,"selected",(f=n[15])==null?void 0:f.selected)},i(c){r||(U(e.$$.fragment,c),r=!0)},o(c){F(e.$$.fragment,c),r=!1},d(c){c&&m(s),se(e),i=!1,o()}}}function Rt(n){var k;let s,e,t=((k=n[15])==null?void 0:k.label)+"",l,r,i,o,a,c,u;const d=[ji,Fi,Vi],h=[];function p(f,b){return f[15].type==="button"?0:f[15].type==="color"?1:2}return a=p(n),c=h[a]=d[a](n),{c(){s=T("div"),e=T("label"),l=Me(t),r=Me(":"),o=K(),c.c(),this.h()},l(f){s=S(f,"DIV",{class:!0});var b=z(s);e=S(b,"LABEL",{for:!0});var _=z(e);l=De(_,t),r=De(_,":"),_.forEach(m),o=Z(b),c.l(b),b.forEach(m),this.h()},h(){var f,b;g(e,"for",i=(f=n[15])==null?void 0:f.id),g(s,"class","konva-attribute svelte-174212j"),_e(s,"grow",((b=n[15])==null?void 0:b.className)==="grow-item")},m(f,b){V(f,s,b),$(s,e),$(e,l),$(e,r),$(s,o),h[a].m(s,null),u=!0},p(f,b){var E,G,C;(!u||b&16)&&t!==(t=((E=f[15])==null?void 0:E.label)+"")&&Qe(l,t),(!u||b&16&&i!==(i=(G=f[15])==null?void 0:G.id))&&g(e,"for",i);let _=a;a=p(f),a===_?h[a].p(f,b):(Be(),F(h[_],1,1,()=>{h[_]=null}),ze(),c=h[a],c?c.p(f,b):(c=h[a]=d[a](f),c.c()),U(c,1),c.m(s,null)),(!u||b&16)&&_e(s,"grow",((C=f[15])==null?void 0:C.className)==="grow-item")},i(f){u||(U(c),u=!0)},o(f){F(c),u=!1},d(f){f&&m(s),h[a].d()}}}function Ut(n){let s,e;return{c(){s=T("option"),this.h()},l(t){s=S(t,"OPTION",{}),z(s).forEach(m),this.h()},h(){s.__value=e=n[12],We(s,s.__value)},m(t,l){V(t,s,l)},p(t,l){l&8&&e!==(e=t[12])&&(s.__value=e,We(s,s.__value))},d(t){t&&m(s)}}}function Wi(n){let s,e,t,l;const r=[Ri,Pi,Li],i=[];function o(a,c){var u,d,h;return((u=a[1])==null?void 0:u.length)===0?0:((d=a[1])==null?void 0:d.length)===1?1:((h=a[1])==null?void 0:h.length)>1?2:-1}return~(e=o(n))&&(t=i[e]=r[e](n)),{c(){s=T("div"),t&&t.c(),this.h()},l(a){s=S(a,"DIV",{class:!0});var c=z(s);t&&t.l(c),c.forEach(m),this.h()},h(){g(s,"class","konva-attribute-section svelte-174212j")},m(a,c){V(a,s,c),~e&&i[e].m(s,null),l=!0},p(a,[c]){let u=e;e=o(a),e===u?~e&&i[e].p(a,c):(t&&(Be(),F(i[u],1,1,()=>{i[u]=null}),ze()),~e?(t=i[e],t?t.p(a,c):(t=i[e]=r[e](a),t.c()),U(t,1),t.m(s,null)):t=null)},i(a){l||(U(t),l=!0)},o(a){F(t),l=!1},d(a){a&&m(s),~e&&i[e].d()}}}function _t(n){if(!n||typeof n!="object")return 0;let s=0;if(n.className&&n.className!=="Group")s=1;else if(Array.isArray(n.children))for(const e of n.children)s+=_t(e);return s}function qi(n,s,e){let t,l,{konva:r}=s,{selectedShape:i}=s,{selectedShapes:o}=s,{setAttribute:a}=s,{entityOptions:c}=s,u=[];function d(f,b,_){const E=_.target;E&&r.updateAttr(f,b,E.value,!0)}const h=(f,b)=>{var _;return a((_=i==null?void 0:i.attrs)==null?void 0:_.id,f==null?void 0:f.id,b)},p=(f,b)=>{var _;return d((_=i==null?void 0:i.attrs)==null?void 0:_.id,f==null?void 0:f.id,b)},k=(f,b)=>{var _;return a((_=i==null?void 0:i.attrs)==null?void 0:_.id,f==null?void 0:f.id,b)};return n.$$set=f=>{"konva"in f&&e(6,r=f.konva),"selectedShape"in f&&e(0,i=f.selectedShape),"selectedShapes"in f&&e(1,o=f.selectedShapes),"setAttribute"in f&&e(2,a=f.setAttribute),"entityOptions"in f&&e(3,c=f.entityOptions)},n.$$.update=()=>{var f,b,_,E,G,C,H,N,w,O,M,L,Y,j,y,P,D,I,v,A,R,W,q,ce,ae,de,ge,me,ye,Ce,Ie,Le,ke,Se,Ae,re;n.$$.dirty&1&&e(7,t={id:"opacity",label:"Opacity",type:"text",unit:"%",value:((f=i==null?void 0:i.attrs)==null?void 0:f.opacity)!=null?Math.round(((b=i==null?void 0:i.attrs)==null?void 0:b.opacity)*100):100,disabled:!((_=i==null?void 0:i.attrs)!=null&&_.draggable)}),n.$$.dirty&193&&e(8,l=[{id:"box",label:"Box",type:"button",icon:le.textBox,selected:(E=i==null?void 0:i.attrs)==null?void 0:E.box,onclick:()=>{var X;return r.toggleTextBox((X=i==null?void 0:i.attrs)==null?void 0:X.id)},disabled:!((G=i==null?void 0:i.attrs)!=null&&G.draggable)},{id:"fill",label:"Color",type:"color",value:(C=i==null?void 0:i.attrs)==null?void 0:C.fill,width:"2.5rem",disabled:!((H=i==null?void 0:i.attrs)!=null&&H.draggable)},{...t}]),n.$$.dirty&385&&(((N=i==null?void 0:i.attrs)==null?void 0:N.type)==="icon"?e(4,u=[{id:"icon",label:"Icon",type:"text",className:"grow-item",disabled:!i.attrs.draggable,value:i.attrs.icon},{id:"color",label:"Color",type:"color",width:"2.5rem",disabled:!i.attrs.draggable,value:i.attrs.color},{id:"width",label:"Width",type:"text",unit:" px",value:i.attrs.width,disabled:!i.attrs.draggable},{id:"height",label:"Height",type:"text",unit:" px",value:i.attrs.height,disabled:!i.attrs.draggable},{...t}]):((w=i==null?void 0:i.attrs)==null?void 0:w.type)==="state-icon"?e(4,u=[{id:"entity_id",label:"Entity",type:"text",className:"grow-item",disabled:!i.attrs.draggable,value:i.attrs.entity_id,list:"entityOptions"},{id:"width",label:"Width",type:"text",unit:" px",value:i.attrs.width,disabled:!i.attrs.draggable},{id:"height",label:"Height",type:"text",unit:" px",value:i.attrs.height,disabled:!i.attrs.draggable},{id:"color",label:"Color",type:"color",width:"2.5rem",disabled:!i.attrs.draggable,value:i.attrs.color||i.attrs.state_color||"#ffffff"},{...t}]):((O=i==null?void 0:i.attrs)==null?void 0:O.type)==="text"?e(4,u=[{id:"text",label:"Text",value:(M=i==null?void 0:i.attrs)==null?void 0:M.text,type:"textarea",className:"grow-item",disabled:!((L=i==null?void 0:i.attrs)!=null&&L.draggable)},...l]):((Y=i==null?void 0:i.attrs)==null?void 0:Y.type)==="state-label"?e(4,u=[{id:"entity_id",label:"Entity",value:(j=i==null?void 0:i.attrs)==null?void 0:j.entity_id,type:"text",className:"grow-item",disabled:!((y=i==null?void 0:i.attrs)!=null&&y.draggable),list:"entityOptions"},...l]):((P=i==null?void 0:i.attrs)==null?void 0:P.type)==="image"?e(4,u=[{id:"src",label:"Source",value:(D=i==null?void 0:i.attrs)==null?void 0:D.src,type:"text",className:"grow-item",disabled:!((I=i==null?void 0:i.attrs)!=null&&I.draggable)},{id:"width",label:"Width",type:"text",unit:" px",value:(v=i==null?void 0:i.attrs)==null?void 0:v.width,disabled:!((A=i==null?void 0:i.attrs)!=null&&A.draggable)},{id:"height",label:"Height",type:"text",unit:" px",value:(R=i==null?void 0:i.attrs)==null?void 0:R.height,disabled:!((W=i==null?void 0:i.attrs)!=null&&W.draggable)},{...t}]):((q=i==null?void 0:i.attrs)==null?void 0:q.type)==="rectangle"?e(4,u=[{id:"width",label:"Width",type:"text",unit:" px",value:(ce=i==null?void 0:i.attrs)==null?void 0:ce.width,disabled:!((ae=i==null?void 0:i.attrs)!=null&&ae.draggable)},{id:"height",label:"Height",type:"text",unit:" px",value:(de=i==null?void 0:i.attrs)==null?void 0:de.height,disabled:!((ge=i==null?void 0:i.attrs)!=null&&ge.draggable)},{id:"fill",label:"Fill",type:"color",value:(me=i==null?void 0:i.attrs)==null?void 0:me.fill,width:"2.5rem",disabled:!((ye=i==null?void 0:i.attrs)!=null&&ye.draggable)},{id:"cornerRadius",label:"Radius",type:"text",unit:" px",value:(Ce=i==null?void 0:i.attrs)==null?void 0:Ce.cornerRadius,disabled:!((Ie=i==null?void 0:i.attrs)!=null&&Ie.draggable)},{...t}]):((Le=i==null?void 0:i.attrs)==null?void 0:Le.type)==="circle"?e(4,u=[{id:"radius",label:"Radius",type:"text",unit:" px",value:(ke=i==null?void 0:i.attrs)==null?void 0:ke.radius,disabled:!((Se=i==null?void 0:i.attrs)!=null&&Se.draggable)},{id:"fill",label:"Fill",type:"color",value:(Ae=i==null?void 0:i.attrs)==null?void 0:Ae.fill,width:"2.5rem",disabled:!((re=i==null?void 0:i.attrs)!=null&&re.draggable)},{...t}]):e(4,u=[]))},[i,o,a,c,u,d,r,t,l,h,p,k]}class Xi extends Ve{constructor(s){super(),Fe(this,s,qi,Wi,Ge,{konva:6,selectedShape:0,selectedShapes:1,setAttribute:2,entityOptions:3})}}function Yi(n){var Ie,Le,ke,Se,Ae,re,X,he,pe,ve,J,ue;let s,e,t,l,r,i,o,a,c,u,d,h,p,k,f,b,_,E,G,C,H,N,w,O,M,L,Y,j,y,P,D,I,v,A,R,W,q,ce,ae,de,ge,me,ye,Ce;return e=new oe({props:{icon:(Ie=le)==null?void 0:Ie.default,width:"15",height:"15"}}),r=new oe({props:{icon:(Le=le)==null?void 0:Le.pan,width:"15",height:"15"}}),a=new oe({props:{icon:(ke=le)==null?void 0:ke.zoom,width:"15",height:"15"}}),p=new oe({props:{icon:(Se=le)==null?void 0:Se["state-label"],width:"18",height:"18"}}),b=new oe({props:{icon:(Ae=le)==null?void 0:Ae["state-icon"],width:"20",height:"20"}}),H=new oe({props:{icon:(re=le)==null?void 0:re.text,width:"20",height:"20"}}),O=new oe({props:{icon:(X=le)==null?void 0:X.icon,width:"18",height:"18"}}),Y=new oe({props:{icon:(he=le)==null?void 0:he.image,width:"18",height:"18"}}),P=new oe({props:{icon:(pe=le)==null?void 0:pe.rectangle,width:"18",height:"18"}}),v=new oe({props:{icon:(ve=le)==null?void 0:ve.circle,width:"18",height:"18"}}),ce=new oe({props:{icon:(J=le)==null?void 0:J["v-guide"],width:"16",height:"16"}}),ge=new oe({props:{icon:(ue=le)==null?void 0:ue["h-guide"],width:"16",height:"16"}}),{c(){s=T("button"),ee(e.$$.fragment),t=K(),l=T("button"),ee(r.$$.fragment),i=K(),o=T("button"),ee(a.$$.fragment),c=K(),u=T("span"),d=K(),h=T("button"),ee(p.$$.fragment),k=K(),f=T("button"),ee(b.$$.fragment),_=K(),E=T("span"),G=K(),C=T("button"),ee(H.$$.fragment),N=K(),w=T("button"),ee(O.$$.fragment),M=K(),L=T("button"),ee(Y.$$.fragment),j=K(),y=T("button"),ee(P.$$.fragment),D=K(),I=T("button"),ee(v.$$.fragment),A=K(),R=T("span"),W=K(),q=T("button"),ee(ce.$$.fragment),ae=K(),de=T("button"),ee(ge.$$.fragment),this.h()},l(B){s=S(B,"BUTTON",{title:!0,class:!0});var ne=z(s);te(e.$$.fragment,ne),ne.forEach(m),t=Z(B),l=S(B,"BUTTON",{title:!0,class:!0});var Ee=z(l);te(r.$$.fragment,Ee),Ee.forEach(m),i=Z(B),o=S(B,"BUTTON",{title:!0,class:!0});var Ne=z(o);te(a.$$.fragment,Ne),Ne.forEach(m),c=Z(B),u=S(B,"SPAN",{class:!0}),z(u).forEach(m),d=Z(B),h=S(B,"BUTTON",{title:!0,class:!0});var be=z(h);te(p.$$.fragment,be),be.forEach(m),k=Z(B),f=S(B,"BUTTON",{title:!0,class:!0});var Pe=z(f);te(b.$$.fragment,Pe),Pe.forEach(m),_=Z(B),E=S(B,"SPAN",{class:!0}),z(E).forEach(m),G=Z(B),C=S(B,"BUTTON",{title:!0,class:!0});var et=z(C);te(H.$$.fragment,et),et.forEach(m),N=Z(B),w=S(B,"BUTTON",{title:!0,class:!0});var qe=z(w);te(O.$$.fragment,qe),qe.forEach(m),M=Z(B),L=S(B,"BUTTON",{title:!0,class:!0});var tt=z(L);te(Y.$$.fragment,tt),tt.forEach(m),j=Z(B),y=S(B,"BUTTON",{title:!0,class:!0});var it=z(y);te(P.$$.fragment,it),it.forEach(m),D=Z(B),I=S(B,"BUTTON",{title:!0,class:!0});var $e=z(I);te(v.$$.fragment,$e),$e.forEach(m),A=Z(B),R=S(B,"SPAN",{class:!0}),z(R).forEach(m),W=Z(B),q=S(B,"BUTTON",{title:!0,class:!0});var st=z(q);te(ce.$$.fragment,st),st.forEach(m),ae=Z(B),de=S(B,"BUTTON",{title:!0,class:!0});var lt=z(de);te(ge.$$.fragment,lt),lt.forEach(m),this.h()},h(){var B,ne,Ee;g(s,"title","Select (V), Double-click to Deselect All"),g(s,"class","svelte-xy4hy2"),_e(s,"selected",((B=n[1])==null?void 0:B.mode)==="default"),g(l,"title","Pan (H), Double-click to Fit Canvas"),g(l,"class","svelte-xy4hy2"),_e(l,"selected",((ne=n[1])==null?void 0:ne.mode)==="pan"),g(o,"title","Zoom (Z), Double-click to Reset Zoom"),g(o,"class","svelte-xy4hy2"),_e(o,"selected",((Ee=n[1])==null?void 0:Ee.mode)==="zoom"),g(u,"class","divider svelte-xy4hy2"),g(h,"title","Add New State Label"),g(h,"class","svelte-xy4hy2"),g(f,"title","Add New State Icon"),g(f,"class","svelte-xy4hy2"),g(E,"class","divider svelte-xy4hy2"),g(C,"title","Add New Text"),g(C,"class","svelte-xy4hy2"),g(w,"title","Add New Icon"),g(w,"class","svelte-xy4hy2"),g(L,"title","Add New Image"),g(L,"class","svelte-xy4hy2"),g(y,"title","Add New Rectangle"),g(y,"class","svelte-xy4hy2"),g(I,"title","Add New Circle"),g(I,"class","svelte-xy4hy2"),g(R,"class","divider svelte-xy4hy2"),g(q,"title","Add New Vertical Guide"),g(q,"class","svelte-xy4hy2"),g(de,"title","Add New Horizontal Guide"),g(de,"class","svelte-xy4hy2")},m(B,ne){V(B,s,ne),ie(e,s,null),V(B,t,ne),V(B,l,ne),ie(r,l,null),V(B,i,ne),V(B,o,ne),ie(a,o,null),V(B,c,ne),V(B,u,ne),V(B,d,ne),V(B,h,ne),ie(p,h,null),V(B,k,ne),V(B,f,ne),ie(b,f,null),V(B,_,ne),V(B,E,ne),V(B,G,ne),V(B,C,ne),ie(H,C,null),V(B,N,ne),V(B,w,ne),ie(O,w,null),V(B,M,ne),V(B,L,ne),ie(Y,L,null),V(B,j,ne),V(B,y,ne),ie(P,y,null),V(B,D,ne),V(B,I,ne),ie(v,I,null),V(B,A,ne),V(B,R,ne),V(B,W,ne),V(B,q,ne),ie(ce,q,null),V(B,ae,ne),V(B,de,ne),ie(ge,de,null),me=!0,ye||(Ce=[x(s,"click",n[2]),x(s,"dblclick",n[3]),x(l,"click",n[4]),x(l,"dblclick",n[5]),x(o,"click",n[6]),x(o,"dblclick",n[7]),x(h,"click",n[8]),x(f,"click",n[9]),x(C,"click",n[10]),x(w,"click",n[11]),x(L,"click",n[12]),x(y,"click",n[13]),x(I,"click",n[14]),x(q,"click",n[15]),x(de,"click",n[16])],ye=!0)},p(B,[ne]){var Ee,Ne,be;(!me||ne&2)&&_e(s,"selected",((Ee=B[1])==null?void 0:Ee.mode)==="default"),(!me||ne&2)&&_e(l,"selected",((Ne=B[1])==null?void 0:Ne.mode)==="pan"),(!me||ne&2)&&_e(o,"selected",((be=B[1])==null?void 0:be.mode)==="zoom")},i(B){me||(U(e.$$.fragment,B),U(r.$$.fragment,B),U(a.$$.fragment,B),U(p.$$.fragment,B),U(b.$$.fragment,B),U(H.$$.fragment,B),U(O.$$.fragment,B),U(Y.$$.fragment,B),U(P.$$.fragment,B),U(v.$$.fragment,B),U(ce.$$.fragment,B),U(ge.$$.fragment,B),me=!0)},o(B){F(e.$$.fragment,B),F(r.$$.fragment,B),F(a.$$.fragment,B),F(p.$$.fragment,B),F(b.$$.fragment,B),F(H.$$.fragment,B),F(O.$$.fragment,B),F(Y.$$.fragment,B),F(P.$$.fragment,B),F(v.$$.fragment,B),F(ce.$$.fragment,B),F(ge.$$.fragment,B),me=!1},d(B){B&&(m(s),m(t),m(l),m(i),m(o),m(c),m(u),m(d),m(h),m(k),m(f),m(_),m(E),m(G),m(C),m(N),m(w),m(M),m(L),m(j),m(y),m(D),m(I),m(A),m(R),m(W),m(q),m(ae),m(de)),se(e),se(r),se(a),se(p),se(b),se(H),se(O),se(Y),se(P),se(v),se(ce),se(ge),ye=!1,Oe(Ce)}}}function Ki(n,s,e){let t;He(n,Xe,C=>e(1,t=C));let{konva:l}=s;const r=()=>l.setMode("default"),i=()=>{l.deselectAll(),t!=null&&t.selectedShapes&&gt(Xe,t.selectedShapes=[],t)},o=()=>l.setMode("pan"),a=()=>l.fitCanvas(),c=()=>l.setMode("zoom"),u=()=>{l.setZoom("reset",{x:l.stage.width()/2,y:l.stage.height()/2})},d=()=>l.addStateLabel(),h=()=>l.addStateIcon(),p=()=>l.addText(),k=()=>l.addIcon(),f=()=>l.addImage(),b=()=>l.addRectangle(),_=()=>l.addCircle(),E=()=>l.addVerticalGuide(),G=()=>l.addHorizontalGuide();return n.$$set=C=>{"konva"in C&&e(0,l=C.konva)},[l,t,r,i,o,a,c,u,d,h,p,k,f,b,_,E,G]}class Zi extends Ve{constructor(s){super(),Fe(this,s,Ki,Yi,Ge,{konva:0})}}function Ji(n){let s,e;return{c:we,l:we,m(t,l){s||(e=[x(window,"keydown",n[0]),x(window,"keyup",n[1])],s=!0)},p:we,i:we,o:we,d(t){s=!1,Oe(e)}}}const ut=.5;function Qi(n,s,e){let{konva:t}=s;function l(i){const{target:o,metaKey:a,ctrlKey:c,shiftKey:u,key:d}=i,h=o==null?void 0:o.tagName;if(h==="INPUT"||h==="TEXTAREA")return;const p=a||c;if(p){if(p)switch(d){case"a":i.preventDefault(),t.selectAll();break;case"j":i.preventDefault(),t.duplicateSelected();break;case"g":i.preventDefault(),t.handleGroup();break;case"l":i.preventDefault(),t.toggleDraggable();break;case",":i.preventDefault(),t.toggleVisibility();break;case"z":i.preventDefault(),u?t.redo():t.undo();break}}else switch(d){case"v":t.setMode("default");break;case"h":t.setMode("pan");break;case"z":t.setMode("zoom");break;case"Alt":e(2,t.altKey=!0,t),t.updateCursor();break;case" ":e(2,t.spaceKey=!0,t),t.startPan();break;case"Shift":e(2,t.shiftPressed=!0,t),t.updateRotationSnaps();break;case"Delete":case"Backspace":t.deleteSelected();break;case"ArrowUp":t.moveSelectedShapes(0,-ut);break;case"ArrowRight":t.moveSelectedShapes(ut,0);break;case"ArrowDown":t.moveSelectedShapes(0,ut);break;case"ArrowLeft":t.moveSelectedShapes(-ut,0);break}}function r(i){const{key:o,code:a}=i;o==="Alt"?(e(2,t.altKey=!1,t),t.updateCursor()):a==="Space"?(e(2,t.spaceKey=!1,t),t.stopPan()):o==="Shift"&&(e(2,t.shiftPressed=!1,t),t.updateRotationSnaps())}return n.$$set=i=>{"konva"in i&&e(2,t=i.konva)},[l,r,t]}class xi extends Ve{constructor(s){super(),Fe(this,s,Qi,Ji,Ge,{konva:2})}}function es(n){let s,e,t;return{c(){s=T("div"),this.h()},l(l){s=S(l,"DIV",{class:!0}),z(s).forEach(m),this.h()},h(){g(s,"class","svelte-15zabj0")},m(l,r){V(l,s,r),e||(t=[x(window,"pointermove",n[1]),x(window,"pointerup",n[4]),x(s,"pointerdown",n[5])],e=!0)},p:we,i:we,o:we,d(l){l&&m(s),e=!1,Oe(t)}}}function ts(n,s,e){let{resizing:t}=s,{container:l}=s,{panelsWidth:r}=s,i;pt(()=>{i=3*parseFloat(getComputedStyle(document.documentElement).fontSize)});function o(u){if(!t)return;const d=l.getBoundingClientRect(),h=d.width-i*2,p=d.right-u.clientX;e(2,r=Math.max(i,Math.min(h,p)))}const a=()=>e(0,t=!1),c=()=>e(0,t=!0);return n.$$set=u=>{"resizing"in u&&e(0,t=u.resizing),"container"in u&&e(3,l=u.container),"panelsWidth"in u&&e(2,r=u.panelsWidth)},[t,o,r,l,a,c]}class is extends Ve{constructor(s){super(),Fe(this,s,ts,es,Ge,{resizing:0,container:3,panelsWidth:2})}}async function ss(){await document.fonts.ready;const s=(typeof OffscreenCanvas<"u"?new OffscreenCanvas(0,0):document.createElement("canvas")).getContext("2d");if(!s)return[];const e="abcdefghijklmnopqrstuvwxyz0123456789";s.font="12px monospace";const t=s.measureText(e).width;return ls.filter(l=>(s.font=`12px "${l}", monospace`,s.measureText(e).width!==t))}const ls=["American Typewriter","Andale Mono","Arial","Arial Black","Arial Narrow","Arial Rounded MT Bold","Arial Unicode MS","Avenir","Avenir Next","Avenir Next Condensed","Bahnschrift","Baskerville","Big Caslon","Bodoni 72","Bodoni 72 Oldstyle","Bodoni 72 Smallcaps","Bradley Hand","Brush Script MT","Calibri","Cambria","Cambria Math","Candara","Chalkboard","Chalkboard SE","Chalkduster","Charter","Cochin","Comic Sans MS","Consolas","Constantia","Copperplate","Corbel","Courier","Courier New","DIN Alternate","DIN Condensed","Didot","Ebrima","Franklin Gothic Medium","Futura","Gabriola","Gadugi","Geneva","Georgia","Gill Sans","Helvetica","Helvetica Neue","Herculanum","Hoefler Text","HoloLens MDL2 Assets","Impact","Ink Free","Inter Variable","Javanese Text","Leelawadee UI","Lucida Console","Lucida Grande","Lucida Sans Unicode","Luminari","MS Gothic","MV Boli","Malgun Gothic","Marker Felt","Marlett","Menlo","Microsoft Himalaya","Microsoft JhengHei","Microsoft New Tai Lue","Microsoft PhagsPa","Microsoft Sans Serif","Microsoft Tai Le","Microsoft YaHei","Microsoft Yi Baiti","MingLiU-ExtB","Monaco","Mongolian Baiti","Myanmar Text","Nirmala UI","Noteworthy","Optima","Palatino","Palatino Linotype","Papyrus","Phosphate","Rockwell","Savoye LET","Segoe MDL2 Assets","Segoe Print","Segoe Script","Segoe UI","Segoe UI Emoji","Segoe UI Historic","Segoe UI Symbol","SignPainter","SimSun","Sitka","Skia","Snell Roundhand","Symbol","Sylfaen","Tahoma","Times","Times New Roman","Trattatello","Trebuchet MS","Verdana","Webdings","Wingdings","Yu Gothic","Zapfino"];function Gt(n,s,e){const t=n.slice();return t[31]=s[e],t}function Vt(n){let s,e,t,l,r,i,o,a,c,u,d,h,p,k,f,b,_,E,G,C,H,N,w,O,M,L,Y,j,y,P,D,I,v,A,R,W,q,ce,ae,de,ge,me,ye,Ce,Ie,Le,ke,Se,Ae,re,X,he,pe=Te(n[6]),ve=[];for(let J=0;J<pe.length;J+=1)ve[J]=Ft(Gt(n,pe,J));return b=new oe({props:{icon:le.letterSpacing,width:"20",height:"20"}}),N=new oe({props:{icon:le.lineHeight,width:"20",height:"20"}}),y=new oe({props:{icon:le.bold,width:"20",height:"20"}}),I=new oe({props:{icon:le.italic,width:"20",height:"20"}}),q=new oe({props:{icon:le.alignLeft,width:"20",height:"20"}}),de=new oe({props:{icon:le.alignCenter,width:"20",height:"20"}}),ye=new oe({props:{icon:le.alignRight,width:"20",height:"20"}}),Se=new oe({props:{icon:le.ellipsis,width:"20",height:"20"}}),{c(){s=T("div"),e=T("div"),t=K(),l=T("div"),r=T("div"),i=T("input"),o=K(),a=T("datalist");for(let J=0;J<ve.length;J+=1)ve[J].c();c=K(),u=T("div"),d=T("input"),h=K(),p=T("div"),k=T("div"),f=T("div"),ee(b.$$.fragment),_=K(),E=T("input"),G=K(),C=T("div"),H=T("div"),ee(N.$$.fragment),w=K(),O=T("input"),M=K(),L=T("div"),Y=T("div"),j=T("button"),ee(y.$$.fragment),P=K(),D=T("button"),ee(I.$$.fragment),v=K(),A=T("span"),R=K(),W=T("button"),ee(q.$$.fragment),ce=K(),ae=T("button"),ee(de.$$.fragment),ge=K(),me=T("button"),ee(ye.$$.fragment),Ce=K(),Ie=T("span"),Le=K(),ke=T("button"),ee(Se.$$.fragment),this.h()},l(J){s=S(J,"DIV",{class:!0});var ue=z(s);e=S(ue,"DIV",{class:!0}),z(e).forEach(m),t=Z(ue),l=S(ue,"DIV",{class:!0});var B=z(l);r=S(B,"DIV",{class:!0,title:!0});var ne=z(r);i=S(ne,"INPUT",{type:!0,id:!0,list:!0,class:!0}),o=Z(ne),a=S(ne,"DATALIST",{id:!0});var Ee=z(a);for(let bt=0;bt<ve.length;bt+=1)ve[bt].l(Ee);Ee.forEach(m),ne.forEach(m),c=Z(B),u=S(B,"DIV",{class:!0,title:!0});var Ne=z(u);d=S(Ne,"INPUT",{type:!0,id:!0,class:!0}),Ne.forEach(m),B.forEach(m),h=Z(ue),p=S(ue,"DIV",{class:!0});var be=z(p);k=S(be,"DIV",{class:!0,title:!0});var Pe=z(k);f=S(Pe,"DIV",{class:!0});var et=z(f);te(b.$$.fragment,et),et.forEach(m),_=Z(Pe),E=S(Pe,"INPUT",{type:!0,id:!0,class:!0}),Pe.forEach(m),G=Z(be),C=S(be,"DIV",{class:!0,title:!0});var qe=z(C);H=S(qe,"DIV",{class:!0});var tt=z(H);te(N.$$.fragment,tt),tt.forEach(m),w=Z(qe),O=S(qe,"INPUT",{type:!0,id:!0,class:!0}),qe.forEach(m),be.forEach(m),M=Z(ue),L=S(ue,"DIV",{class:!0});var it=z(L);Y=S(it,"DIV",{class:!0});var $e=z(Y);j=S($e,"BUTTON",{title:!0,id:!0,class:!0});var st=z(j);te(y.$$.fragment,st),st.forEach(m),P=Z($e),D=S($e,"BUTTON",{title:!0,id:!0,class:!0});var lt=z(D);te(I.$$.fragment,lt),lt.forEach(m),v=Z($e),A=S($e,"SPAN",{class:!0}),z(A).forEach(m),R=Z($e),W=S($e,"BUTTON",{title:!0,id:!0,class:!0});var wt=z(W);te(q.$$.fragment,wt),wt.forEach(m),ce=Z($e),ae=S($e,"BUTTON",{title:!0,id:!0,class:!0});var Et=z(ae);te(de.$$.fragment,Et),Et.forEach(m),ge=Z($e),me=S($e,"BUTTON",{title:!0,id:!0,class:!0});var $t=z(me);te(ye.$$.fragment,$t),$t.forEach(m),Ce=Z($e),Ie=S($e,"SPAN",{class:!0}),z(Ie).forEach(m),Le=Z($e),ke=S($e,"BUTTON",{title:!0,id:!0,class:!0});var It=z(ke);te(Se.$$.fragment,It),It.forEach(m),$e.forEach(m),it.forEach(m),ue.forEach(m),this.h()},h(){var J,ue,B,ne;g(e,"class","top"),g(i,"type","text"),g(i,"id","fontFamily"),g(i,"list","font-list"),i.value=n[12],i.disabled=n[13],g(i,"class","svelte-1qiv62f"),g(a,"id","font-list"),g(r,"class","item svelte-1qiv62f"),g(r,"title","Font"),g(d,"type","text"),g(d,"id","fontSize"),d.value=n[11],d.disabled=n[13],g(d,"class","svelte-1qiv62f"),g(u,"class","item svelte-1qiv62f"),g(u,"title","Size"),g(l,"class","group-font-size svelte-1qiv62f"),g(f,"class","icon svelte-1qiv62f"),g(E,"type","text"),g(E,"id","letterSpacing"),E.value=n[10],E.disabled=n[13],g(E,"class","svelte-1qiv62f"),g(k,"class","item svelte-1qiv62f"),g(k,"title","Letter Spacing"),g(H,"class","icon svelte-1qiv62f"),g(O,"type","text"),g(O,"id","lineHeight"),O.value=n[7],O.disabled=n[13],g(O,"class","svelte-1qiv62f"),g(C,"class","item svelte-1qiv62f"),g(C,"title","Line Height"),g(p,"class","group-spacing-height svelte-1qiv62f"),g(j,"title","Bold"),g(j,"id","bold"),j.disabled=n[13],g(j,"class","svelte-1qiv62f"),_e(j,"selected",(ue=(J=n[4])==null?void 0:J.fontStyle)==null?void 0:ue.includes(vt)),g(D,"title","Italic"),g(D,"id","italic"),D.disabled=n[13],g(D,"class","svelte-1qiv62f"),_e(D,"selected",(ne=(B=n[4])==null?void 0:B.fontStyle)==null?void 0:ne.includes("italic")),g(A,"class","divider svelte-1qiv62f"),g(W,"title","Align Left"),g(W,"id","alignLeft"),W.disabled=n[13],g(W,"class","svelte-1qiv62f"),_e(W,"selected",n[9]==="left"),g(ae,"title","Align Center"),g(ae,"id","alignCenter"),ae.disabled=n[13],g(ae,"class","svelte-1qiv62f"),_e(ae,"selected",n[9]==="center"),g(me,"title","Align Right"),g(me,"id","alignRight"),me.disabled=n[13],g(me,"class","svelte-1qiv62f"),_e(me,"selected",n[9]==="right"),g(Ie,"class","divider svelte-1qiv62f"),g(ke,"title","Ellipsis"),g(ke,"id","ellipsis"),ke.disabled=n[13],g(ke,"class","svelte-1qiv62f"),_e(ke,"selected",n[8]),g(Y,"class","item svelte-1qiv62f"),g(L,"class","group-weight-align svelte-1qiv62f"),g(s,"class","items svelte-1qiv62f")},m(J,ue){V(J,s,ue),$(s,e),$(s,t),$(s,l),$(l,r),$(r,i),$(r,o),$(r,a);for(let B=0;B<ve.length;B+=1)ve[B]&&ve[B].m(a,null);$(l,c),$(l,u),$(u,d),$(s,h),$(s,p),$(p,k),$(k,f),ie(b,f,null),$(k,_),$(k,E),$(p,G),$(p,C),$(C,H),ie(N,H,null),$(C,w),$(C,O),$(s,M),$(s,L),$(L,Y),$(Y,j),ie(y,j,null),$(Y,P),$(Y,D),ie(I,D,null),$(Y,v),$(Y,A),$(Y,R),$(Y,W),ie(q,W,null),$(Y,ce),$(Y,ae),ie(de,ae,null),$(Y,ge),$(Y,me),ie(ye,me,null),$(Y,Ce),$(Y,Ie),$(Y,Le),$(Y,ke),ie(Se,ke,null),re=!0,X||(he=[x(i,"input",n[22]),x(i,"change",n[23]),x(d,"change",n[24]),x(E,"change",n[25]),x(O,"change",n[15]),x(j,"click",n[26]),x(D,"click",n[27]),x(W,"click",n[28]),x(ae,"click",n[29]),x(me,"click",n[30]),x(ke,"click",n[17])],X=!0)},p(J,ue){var B,ne,Ee,Ne;if((!re||ue[0]&4096&&i.value!==J[12])&&(i.value=J[12]),(!re||ue[0]&8192)&&(i.disabled=J[13]),ue[0]&64){pe=Te(J[6]);let be;for(be=0;be<pe.length;be+=1){const Pe=Gt(J,pe,be);ve[be]?ve[be].p(Pe,ue):(ve[be]=Ft(Pe),ve[be].c(),ve[be].m(a,null))}for(;be<ve.length;be+=1)ve[be].d(1);ve.length=pe.length}(!re||ue[0]&2048&&d.value!==J[11])&&(d.value=J[11]),(!re||ue[0]&8192)&&(d.disabled=J[13]),(!re||ue[0]&1024&&E.value!==J[10])&&(E.value=J[10]),(!re||ue[0]&8192)&&(E.disabled=J[13]),(!re||ue[0]&128&&O.value!==J[7])&&(O.value=J[7]),(!re||ue[0]&8192)&&(O.disabled=J[13]),(!re||ue[0]&8192)&&(j.disabled=J[13]),(!re||ue[0]&16)&&_e(j,"selected",(ne=(B=J[4])==null?void 0:B.fontStyle)==null?void 0:ne.includes(vt)),(!re||ue[0]&8192)&&(D.disabled=J[13]),(!re||ue[0]&16)&&_e(D,"selected",(Ne=(Ee=J[4])==null?void 0:Ee.fontStyle)==null?void 0:Ne.includes("italic")),(!re||ue[0]&8192)&&(W.disabled=J[13]),(!re||ue[0]&512)&&_e(W,"selected",J[9]==="left"),(!re||ue[0]&8192)&&(ae.disabled=J[13]),(!re||ue[0]&512)&&_e(ae,"selected",J[9]==="center"),(!re||ue[0]&8192)&&(me.disabled=J[13]),(!re||ue[0]&512)&&_e(me,"selected",J[9]==="right"),(!re||ue[0]&8192)&&(ke.disabled=J[13]),(!re||ue[0]&256)&&_e(ke,"selected",J[8])},i(J){re||(U(b.$$.fragment,J),U(N.$$.fragment,J),U(y.$$.fragment,J),U(I.$$.fragment,J),U(q.$$.fragment,J),U(de.$$.fragment,J),U(ye.$$.fragment,J),U(Se.$$.fragment,J),J&&yt(()=>{re&&(Ae||(Ae=Ze(s,mt,{duration:190,easing:Je},!0)),Ae.run(1))}),re=!0)},o(J){F(b.$$.fragment,J),F(N.$$.fragment,J),F(y.$$.fragment,J),F(I.$$.fragment,J),F(q.$$.fragment,J),F(de.$$.fragment,J),F(ye.$$.fragment,J),F(Se.$$.fragment,J),J&&(Ae||(Ae=Ze(s,mt,{duration:190,easing:Je},!1)),Ae.run(0)),re=!1},d(J){J&&m(s),je(ve,J),se(b),se(N),se(y),se(I),se(q),se(de),se(ye),se(Se),J&&Ae&&Ae.end(),X=!1,Oe(he)}}}function Ft(n){let s,e;return{c(){s=T("option"),this.h()},l(t){s=S(t,"OPTION",{}),z(s).forEach(m),this.h()},h(){s.__value=e=n[31],We(s,s.__value)},m(t,l){V(t,s,l)},p(t,l){l[0]&64&&e!==(e=t[31])&&(s.__value=e,We(s,s.__value))},d(t){t&&m(s)}}}function ns(n){let s,e,t,l,r,i="Text",o,a,c,u,d,h,p,k,f,b,_,E,G,C,H;t=new oe({props:{icon:le.text,width:"20",height:"20"}}),u=new oe({props:{icon:le[n[5]?"expand":"collapse"],width:"20",height:"20"}}),k=new oe({props:{icon:le.textBox,width:"20",height:"20"}});let N=!n[5]&&Vt(n);return{c(){s=T("div"),e=T("div"),ee(t.$$.fragment),l=K(),r=T("h3"),r.textContent=i,o=K(),a=T("div"),c=T("button"),ee(u.$$.fragment),h=K(),p=T("button"),ee(k.$$.fragment),_=K(),N&&N.c(),E=Ue(),this.h()},l(w){s=S(w,"DIV",{class:!0});var O=z(s);e=S(O,"DIV",{class:!0});var M=z(e);te(t.$$.fragment,M),l=Z(M),r=S(M,"H3",{"data-svelte-h":!0}),Ye(r)!=="svelte-18nff9j"&&(r.textContent=i),M.forEach(m),o=Z(O),a=S(O,"DIV",{class:!0});var L=z(a);c=S(L,"BUTTON",{title:!0});var Y=z(c);te(u.$$.fragment,Y),Y.forEach(m),h=Z(L),p=S(L,"BUTTON",{title:!0});var j=z(p);te(k.$$.fragment,j),j.forEach(m),L.forEach(m),O.forEach(m),_=Z(w),N&&N.l(w),E=Ue(),this.h()},h(){var w,O,M,L,Y,j,y;g(e,"class","title"),g(c,"title",d=n[5]?"Expand":"Collapse"),g(p,"title",f=(O=(w=n[1])==null?void 0:w.attrs)!=null&&O.box?"Disable Text Box":"Enable Text Box"),p.disabled=b=((M=n[2])==null?void 0:M.length)!==1||!((Y=(L=n[1])==null?void 0:L.attrs)!=null&&Y.draggable)||!["text","state-label"].includes((y=(j=n[1])==null?void 0:j.attrs)==null?void 0:y.type),g(a,"class","right"),g(s,"class","konva-header svelte-1qiv62f")},m(w,O){V(w,s,O),$(s,e),ie(t,e,null),$(e,l),$(e,r),$(s,o),$(s,a),$(a,c),ie(u,c,null),$(a,h),$(a,p),ie(k,p,null),V(w,_,O),N&&N.m(w,O),V(w,E,O),G=!0,C||(H=[x(p,"click",xe(n[20])),x(s,"click",n[21])],C=!0)},p(w,O){var L,Y,j,y,P,D,I;const M={};O[0]&32&&(M.icon=le[w[5]?"expand":"collapse"]),u.$set(M),(!G||O[0]&32&&d!==(d=w[5]?"Expand":"Collapse"))&&g(c,"title",d),(!G||O[0]&2&&f!==(f=(Y=(L=w[1])==null?void 0:L.attrs)!=null&&Y.box?"Disable Text Box":"Enable Text Box"))&&g(p,"title",f),(!G||O[0]&6&&b!==(b=((j=w[2])==null?void 0:j.length)!==1||!((P=(y=w[1])==null?void 0:y.attrs)!=null&&P.draggable)||!["text","state-label"].includes((I=(D=w[1])==null?void 0:D.attrs)==null?void 0:I.type)))&&(p.disabled=b),w[5]?N&&(Be(),F(N,1,1,()=>{N=null}),ze()):N?(N.p(w,O),O[0]&32&&U(N,1)):(N=Vt(w),N.c(),U(N,1),N.m(E.parentNode,E))},i(w){G||(U(t.$$.fragment,w),U(u.$$.fragment,w),U(k.$$.fragment,w),U(N),G=!0)},o(w){F(t.$$.fragment,w),F(u.$$.fragment,w),F(k.$$.fragment,w),F(N),G=!1},d(w){w&&(m(s),m(_),m(E)),se(t),se(u),se(k),N&&N.d(w),C=!1,Oe(H)}}}const vt="600";function as(n,s,e){let t,l,r,i,o,a,c,u,d,h,{konva:p}=s,{selectedShape:k}=s,{selectedShapes:f}=s,{setAttribute:b}=s,_=!0,E=[];pt(async()=>{e(6,E=await ss())});function G(A,R,W){const q=W==null?void 0:W.target;E.includes(q==null?void 0:q.value)&&p.updateAttr(A,R,q.value,!0)}function C(A){const R=A==null?void 0:A.target;if(R&&R.value){const W=parseFloat(R.value)/100;isNaN(W)?R.value=u:p.updateAttr(l==null?void 0:l.id,"lineHeight",W)}}function H(A,R){const W=new Set((A==null?void 0:A.split(" "))||[]);W.delete("normal"),W.has(R)?W.delete(R):W.add(R);const q=W.size?Array.from(W).join(" "):"normal";p.updateAttr(l==null?void 0:l.id,"fontStyle",q)}function N(){l!=null&&l.ellipsis?p.updateAttr(l==null?void 0:l.id,"ellipsis",!1):p.updateAttr(l==null?void 0:l.id,"ellipsis",!0)}const w=()=>{var A;return p.toggleTextBox((A=k==null?void 0:k.attrs)==null?void 0:A.id)},O=()=>{e(5,_=!_)},M=A=>G(l==null?void 0:l.id,"fontFamily",A),L=A=>b(l==null?void 0:l.id,"fontFamily",A),Y=A=>b(l==null?void 0:l.id,"fontSize",A),j=A=>b(l==null?void 0:l.id,"letterSpacing",A),y=()=>H(l==null?void 0:l.fontStyle,vt),P=()=>H(l==null?void 0:l.fontStyle,"italic"),D=()=>p.updateAttr(l==null?void 0:l.id,"align","left"),I=()=>p.updateAttr(l==null?void 0:l.id,"align","center"),v=()=>p.updateAttr(l==null?void 0:l.id,"align","right");return n.$$set=A=>{"konva"in A&&e(0,p=A.konva),"selectedShape"in A&&e(1,k=A.selectedShape),"selectedShapes"in A&&e(2,f=A.selectedShapes),"setAttribute"in A&&e(3,b=A.setAttribute)},n.$$.update=()=>{n.$$.dirty[0]&4&&e(18,t=(f==null?void 0:f.length)===1),n.$$.dirty[0]&2&&e(4,l=k==null?void 0:k.attrs),n.$$.dirty[0]&16&&e(19,r=["text","state-label"].includes(l==null?void 0:l.type)),n.$$.dirty[0]&786448&&e(13,i=!t||!r||!(l!=null&&l.draggable)),n.$$.dirty[0]&262160&&e(12,o=t&&(l==null?void 0:l.fontFamily)||"Inter Variable"),n.$$.dirty[0]&262160&&e(11,a=t?`${(l==null?void 0:l.fontSize)??0} px`:"14 px"),n.$$.dirty[0]&262160&&e(10,c=t?`${(l==null?void 0:l.letterSpacing)??0} px`:"0 px"),n.$$.dirty[0]&262160&&e(7,u=`${t?((l==null?void 0:l.lineHeight)??1)*100:100}%`),n.$$.dirty[0]&786448&&e(9,d=t&&r?(l==null?void 0:l.align)||"left":void 0),n.$$.dirty[0]&262160&&e(8,h=t&&!!(l!=null&&l.ellipsis))},[p,k,f,b,l,_,E,u,h,d,c,a,o,i,G,C,H,N,t,r,w,O,M,L,Y,j,y,P,D,I,v]}class rs extends Ve{constructor(s){super(),Fe(this,s,as,ns,Ge,{konva:0,selectedShape:1,selectedShapes:2,setAttribute:3},null,[-1,-1])}}class jt extends Ti{constructor(e,t){super(e,t);fe(this,"canvasLayer",new Q.Layer);fe(this,"canvas",new Q.Rect);fe(this,"canvasWidth",470);fe(this,"canvasHeight",265);fe(this,"dragDirection");fe(this,"mode","default");fe(this,"selectionLayer",new Q.Layer);fe(this,"transformer",new Q.Transformer);fe(this,"selectionRect",new Q.Rect);fe(this,"x1",0);fe(this,"y1",0);fe(this,"x2",0);fe(this,"y2",0);fe(this,"selectionThreshold",5);fe(this,"selectionStartX",0);fe(this,"selectionStartY",0);fe(this,"selecting",!1);fe(this,"shiftPressed",!1);fe(this,"dragSelecting",!1);fe(this,"selectedShapes",[]);fe(this,"panning",!1);fe(this,"spaceKey",!1);fe(this,"zoomFactor",1);fe(this,"minZoom",.4);fe(this,"maxZoom",40);fe(this,"currentTween");fe(this,"altKey",!1);fe(this,"undoStack",[]);fe(this,"redoStack",[]);fe(this,"maxHistory",50);fe(this,"applyingState",!1);fe(this,"snapOffset",5);fe(this,"guides",[]);fe(this,"updateGuidePos",()=>{const e=this.layer.find("Line").filter(i=>this.isGuide(i));if(!(e!=null&&e.length)){this.guides=[];return}const t=this.stage.position(),l=this.stage.scaleX(),r=this.stage.scaleY();this.guides=e.map(i=>{var o,a;if(((o=i==null?void 0:i.attrs)==null?void 0:o.type)==="v-guide"){const c=i.points()[0];i.points([c,-t.y/r-this.canvas.y(),c,(this.stage.height()-t.y)/r-this.canvas.y()])}else if(((a=i==null?void 0:i.attrs)==null?void 0:a.type)==="h-guide"){const c=i.points()[1];i.points([-t.x/l-this.canvas.x(),c,(this.stage.width()-t.x)/l-this.canvas.x(),c])}return i})});fe(this,"handleMouseup",e=>{if(this.selecting=!1,!this.selectionRect.visible())return;if(e.preventDefault(),this.mode==="zoom"){if(this.dragSelecting){const c=this.selectionRect.getClientRect(),u=15;c.width>u&&c.height>u&&this.zoomToArea(c)}this.selectionRect.visible(!1),this.dragSelecting=!1;return}const t=this.stage.container().getBoundingClientRect(),l=this.stage.width()/t.width,r=this.stage.height()/t.height,i={x:(e.clientX-t.left)*l,y:(e.clientY-t.top)*r};this.x2=(i.x-this.stage.x())/this.zoomFactor,this.y2=(i.y-this.stage.y())/this.zoomFactor,this.selectionRect.setAttrs({x:Math.min(this.x1,this.x2),y:Math.min(this.y1,this.y2),width:Math.abs(this.x2-this.x1),height:Math.abs(this.y2-this.y1)}),this.mode==="default"&&(this.currentTween=new Q.Tween({node:this.selectionRect,duration:.1,opacity:0,onFinish:()=>{this.selectionRect.setAttrs({visible:!1,opacity:1})}}).play());const o=this.selectionRect.getClientRect(),a=this.layer.getChildren().filter(c=>Q.Util.haveIntersection(o,c.getClientRect())&&c.visible()&&c.draggable()&&!this.isGuide(c));this.transformer.nodes(a),this.selectedShapes=a,this.update()});fe(this,"handleMouseMove",e=>{if(this.mode==="pan"||this.panning||!this.selecting)return;e.preventDefault();const t=this.stage.container().getBoundingClientRect(),l=this.stage.width()/t.width,r=this.stage.height()/t.height,i={x:(e.clientX-t.left)*l,y:(e.clientY-t.top)*r},o=(i.x-this.stage.x())/this.zoomFactor,a=(i.y-this.stage.y())/this.zoomFactor,c=o-this.selectionStartX,u=a-this.selectionStartY;Math.sqrt(c*c+u*u)>this.selectionThreshold/this.zoomFactor&&(this.dragSelecting||(this.x1=o,this.y1=a,this.dragSelecting=!0),this.x2=o,this.y2=a,this.selectionRect.setAttrs({x:Math.min(this.x1,this.x2),y:Math.min(this.y1,this.y2),width:Math.abs(this.x2-this.x1),height:Math.abs(this.y2-this.y1),visible:!0}))});fe(this,"handleShiftDragMove",e=>{const t=e.target;if(!(!(t instanceof Q.Shape)&&!(t instanceof Q.Group)))if(this.shiftPressed){const l=t.getAttr("startPos")||{x:t.x(),y:t.y()};if(!this.dragDirection){const r=Math.abs(t.x()-l.x),i=Math.abs(t.y()-l.y);this.dragDirection=r>i?"x":"y"}this.dragDirection==="x"?t.y(l.y):t.x(l.x)}else this.dragDirection=void 0});this.handleMount(),this.setupCanvas(),this.setupTransformer(),this.setupEvents(),this.subscribeStates();const l={x:this.stage.width()/2,y:this.stage.height()/2};this.setZoom("reset",l),this.update()}update(){var e;Xe.set({children:((e=this.layer.toObject())==null?void 0:e.children)||[],selectedShapes:this.selectedShapes.map(t=>this.getNodeData(t)),mode:this.mode,undoStack:this.undoStack,redoStack:this.redoStack})}updateCallback(){this.update()}async handleMount(){var l;this.layer.find("Text").forEach(r=>{var i;((i=r==null?void 0:r.attrs)==null?void 0:i.type)==="state-label"&&r instanceof Q.Text&&this.updateStateLabel(r,void 0)});const e=this.layer.find("Image"),t=((l=Tt(Nt))==null?void 0:l[this.selId])||{};await Promise.all(e.map(async r=>{if(r instanceof Q.Image){const i=t[r.id()],o=r.getAttr("src");if(i instanceof HTMLImageElement)r.image(i);else{await this.updateImage(r,o,!1);const a=r.image();a instanceof HTMLImageElement&&r.id()&&this.updateImageCache(r.id(),a)}}})),this.record(),this.update()}setupCanvas(){this.stage.add(this.canvasLayer),this.canvasLayer.moveToBottom(),this.canvasLayer.listening(!1),this.canvas.setAttrs({x:(this.stage.width()-this.canvasWidth)/2,y:(this.stage.height()-this.canvasHeight)/2,width:this.canvasWidth,height:this.canvasHeight,fill:"rgba(0, 0, 0, 0.2)",stroke:"rgba(255, 255, 255, 0.25)",strokeWidth:1,strokeScaleEnabled:!1,cornerRadius:9.6}),this.canvasLayer.add(this.canvas),this.layer.position({x:this.canvas.x(),y:this.canvas.y()})}setupTransformer(){this.stage.add(this.selectionLayer),this.selectionLayer.add(this.transformer),this.transformer.setAttrs({keepRatio:!0,rotationSnapTolerance:15/2}),this.transformer.on("transformstart transform transformend",t=>{const l=this.transformer.getActiveAnchor();l&&["top-left","top-right","bottom-left","bottom-right"].includes(l)&&this.transformer.shiftBehavior(this.transformer.keepRatio()?"inverted":"default"),this.transformer.setAttr("boundBoxFunc",(i,o)=>this.transformer.nodes().some(u=>u instanceof Q.Text&&u.getAttr("box"))&&(o.width<0||o.height<0)?i:o),t.type==="transformend"&&this.record(),this.update()}),this.layer.find("Text").forEach(t=>{t.getAttr("box")&&this.addTextBoxEventListener(t)}),this.selectionLayer.add(this.selectionRect),this.selectionRect.setAttrs({stroke:"rgba(255, 255, 255, 0.75)",strokeWidth:1,fill:"rgba(255, 255, 255, 0.025)",visible:!1,listening:!1,strokeScaleEnabled:!1})}setupEvents(){this.stage.on("click tap dragstart",e=>this.handleClick(e)),this.stage.on("add remove dragmove dragend",e=>{const{type:t,target:l}=e;t==="dragmove"&&this.panning&&this.updateGuidePos(),t==="dragend"&&(l==null?void 0:l.className)!==void 0&&this.record(),this.update()}),this.stage.on("mousedown",e=>this.handleMousedown(e)),window.addEventListener("mouseup",this.handleMouseup.bind(this)),window.addEventListener("mousemove",this.handleMouseMove.bind(this)),this.layer.find("Line").filter(e=>this.isGuide(e)).forEach(e=>this.setupGuideEvents(e)),this.layer.on("dragmove",this.handleShiftDragMove),this.setupAltDuplicateEvents(),this.setupGuideSnap()}async handleClick(e){const t=document==null?void 0:document.activeElement;if((t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement)&&(t.blur(),await ot()),this.mode==="pan"||this.spaceKey)return;if(this.mode==="zoom"){const o=this.stage.getPointerPosition();o&&(this.altKey?this.altKey&&this.setZoom("out",o):this.setZoom("in",o));return}const l=e.target;if(l===this.stage){this.deselectAll(),this.update();return}const r=o=>{const a=o.getParent();return a!==this.layer&&a instanceof Q.Group?r(a):o},i=r(l);if(i){if(i.visible()&&i.draggable()&&!this.isGuide(i)){const{ctrlKey:o,metaKey:a}=e.evt,c=o||a,u=this.transformer.nodes().indexOf(i)>=0;if(e.type==="dragstart"){if(!u)if(!c)this.transformer.nodes([i]),this.selectedShapes=[i];else{const d=this.transformer.nodes().concat([i]);this.transformer.nodes(d),this.selectedShapes=d}}else if(!c&&!u)this.transformer.nodes([i]),this.selectedShapes=[i];else if(c&&u){const d=this.transformer.nodes().slice();d.splice(d.indexOf(i),1),this.transformer.nodes(d),this.selectedShapes=d}else if(c&&!u){const d=this.transformer.nodes().concat([i]);this.transformer.nodes(d),this.selectedShapes=d}}this.update()}}handleMousedown(e){if(this.mode==="pan"||this.panning)return;const t=i=>{if(i.draggable())return!0;const o=i.getParent();return o&&o!==this.stage?t(o):!1},l=e.target;if(l===this.stage||!t(l)){e.evt.preventDefault();const i=this.stage.getPointerPosition();if(i){const o=(i.x-this.stage.x())/this.zoomFactor,a=(i.y-this.stage.y())/this.zoomFactor;this.x1=this.x2=o,this.y1=this.y2=a,this.selectionStartX=o,this.selectionStartY=a}this.selectionRect.setAttrs({width:0,height:0,visible:!1}),this.selecting=!0,this.dragSelecting=!1}else this.selecting=!1,(l instanceof Q.Shape||l instanceof Q.Group)&&l.setAttr("startPos",{x:l.x(),y:l.y()})}setupAltDuplicateEvents(){let e=[],t=[],l=!1;this.stage.on("dragstart",r=>{if(!this.altKey||l||(r==null?void 0:r.target)instanceof Q.Line)return;l=!0;const i=this.layer.getChildren();e=this.selectedShapes.filter(a=>!this.isGuide(a)).sort((a,c)=>i.indexOf(a)-i.indexOf(c));const o=e.map(a=>a.zIndex());t=e.map(a=>{var u;const c=a.clone({id:this.generateUniqueId((u=a==null?void 0:a.attrs)==null?void 0:u.type)});if(c&&(this.layer.add(c),a instanceof Q.Image)){const d=a.image();d instanceof HTMLImageElement&&(c.image(d),d instanceof HTMLImageElement&&c.id()&&this.updateImageCache(c.id(),d))}return c}).filter(a=>a!==null),t.forEach((a,c)=>{a.zIndex(o[c])}),e.forEach(a=>a.moveToTop())}),this.stage.on("dragend",()=>{l&&(l=!1,e=[],t=[],this.record(),this.update())})}setupGuideSnap(){this.layer.on("dragmove",e=>{if(this.isGuide(e.target))return;const t=this.selectedShapes.filter(i=>!this.isGuide(i)),l=this.getSnapBoundingBox(t),r=this.getSnapPoints(l);if(r.length){let i=0,o=0;r.forEach(a=>{if(a.orientation==="v-guide")switch(a.snap){case"start":i=a.pos-l.x;break;case"center":i=a.pos-(l.x+l.width/2);break;case"end":i=a.pos-(l.x+l.width);break}else if(a.orientation==="h-guide")switch(a.snap){case"start":o=a.pos-l.y;break;case"center":o=a.pos-(l.y+l.height/2);break;case"end":o=a.pos-(l.y+l.height);break}}),t.forEach(a=>{const c=a.position();a.position({x:c.x+i,y:c.y+o})})}})}getSnapBoundingBox(e){const t=e.map(a=>a.getClientRect({relativeTo:this.layer})),l=Math.min(...t.map(a=>a.x)),r=Math.min(...t.map(a=>a.y)),i=Math.max(...t.map(a=>a.x+a.width))-l,o=Math.max(...t.map(a=>a.y+a.height))-r;return{x:l,y:r,width:i,height:o}}subscribeStates(){this.unsubscribe=kt.subscribe(e=>{this.layer&&e&&this.layer.getChildren(l=>{var r,i;return l.getAttr("entity_id")&&((i=(r=l==null?void 0:l.attrs)==null?void 0:r.type)==null?void 0:i.startsWith("state-"))}).forEach(l=>{this.transformer.nodes().includes(l)||(l instanceof Q.Image?this.updateStateIcon(l,e):l instanceof Q.Text&&this.updateStateLabel(l,e))})})}record(){if(this.applyingState)return;const e={elements:this.layer.children.map(l=>this.getNodeData(l)),selectedShapes:this.selectedShapes.map(l=>l.id())},t=this.undoStack[this.undoStack.length-1];this.stateEqual(t,e)||(this.undoStack.push(e),this.undoStack.length>this.maxHistory&&this.undoStack.shift(),this.redoStack=[]),this.update()}undo(){if(this.undoStack.length>1){const e=this.undoStack.pop();e&&this.redoStack.push(e);const t=this.undoStack[this.undoStack.length-1];this.applyState(t),t.selectedShapes.length===0&&this.restoreSelection(this.selectedShapes.map(l=>l.id())),this.update()}}redo(){if(this.redoStack.length>0){const e=this.redoStack.pop();e&&(this.undoStack.push(e),this.applyState(e),e.selectedShapes.length===0&&this.restoreSelection(this.selectedShapes.map(t=>t.id())),this.update())}}applyState(e){this.applyingState=!0;const t=(i,o)=>{i.children.slice().forEach(a=>{o.some(u=>{var d;return((d=u==null?void 0:u.attrs)==null?void 0:d.id)===a.id()})||a.destroy()}),o.forEach(async(a,c)=>{var d,h,p;if(!((d=a.attrs)!=null&&d.id))return;let u=i.findOne(`#${(h=a==null?void 0:a.attrs)==null?void 0:h.id}`);if(u)l(u,a==null?void 0:a.attrs);else{const k=await r(a);if(k)u=k,i.add(u);else{console.error(`failed to create node with id ${(p=a==null?void 0:a.attrs)==null?void 0:p.id}`);return}}u instanceof Q.Group&&"children"in a&&t(u,a==null?void 0:a.children),u.zIndex(c)})},l=async(i,o)=>{var u;const a=o==null?void 0:o.onclick;i.setAttr("onclick",a?JSON.parse(JSON.stringify(a)):void 0);const c=(u=i==null?void 0:i.attrs)==null?void 0:u.type;if(c==="state-label")i.setAttrs({...o,text:i.getAttr("text")});else if(c==="state-icon")i.setAttrs({...o,image:i.getAttr("image"),color:i.getAttr("color"),icon:i.getAttr("icon")});else if(i instanceof Q.Image&&["image","icon"].includes(c)){const d=i.getAttr("src");if(i.setAttrs(o),(o==null?void 0:o.src)!==d){await this.updateImage(i,o==null?void 0:o.src,!1);const h=i.image();h instanceof HTMLImageElement&&(o!=null&&o.id)&&this.updateImageCache(o==null?void 0:o.id,h)}}else i.setAttrs(o)},r=async i=>{var u,d;let o;const a=i==null?void 0:i.attrs,c=a==null?void 0:a.type;switch(c){case"state-label":o=new Q.Text(a),this.updateStateLabel(o,void 0);break;case"text":o=new Q.Text(a);break;case"rectangle":o=new Q.Rect(a);break;case"circle":o=new Q.Circle(a);break;case"v-guide":case"h-guide":o=new Q.Line(a),this.setupGuideEvents(o);break;case"group":o=new Q.Group(a),i instanceof Q.Group&&i.children&&Array.isArray(i.children)&&i.children.forEach(h=>{const p=r(h);p&&o.add(p)});break;case"image":case"icon":case"state-icon":{o=new Q.Image(a);const h=(d=(u=Tt(Nt))==null?void 0:u[this==null?void 0:this.selId])==null?void 0:d[a==null?void 0:a.id];if(h instanceof HTMLImageElement)o.image(h);else{await this.updateImage(o,a==null?void 0:a.src,!1);const p=o.image();p instanceof HTMLImageElement&&(a!=null&&a.id)&&this.updateImageCache(a==null?void 0:a.id,p)}c==="state-icon"?this.updateStateIcon(o,void 0):c==="icon"&&this.updateIcon(o);break}default:console.error(c,"type not found"),o=new Q.Shape(a)}return o};t(this.layer,e.elements),e.selectedShapes.length>0&&this.restoreSelection(e.selectedShapes),this.updateGuidePos(),this.applyingState=!1,this.update()}restoreSelection(e){this.selectedShapes=e.map(t=>this.layer.findOne(`#${t}`)).filter(t=>t instanceof Q.Shape||t instanceof Q.Group),this.transformer.nodes(this.selectedShapes)}stateEqual(e,t){return!e||!this.arraysEqual(e.selectedShapes,t.selectedShapes)||e.elements.length!==t.elements.length?!1:e.elements.every((l,r)=>{const i=t.elements[r];return this.nodeEqual(l,i)})}arraysEqual(e,t){return e.length!==t.length?!1:e.every((l,r)=>l===t[r])}nodeEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const l in e)if(l==="children"){if(!Array.isArray(e[l])||!Array.isArray(t[l])||e[l].length!==t[l].length||!e[l].every((r,i)=>this.nodeEqual(r,t[l][i])))return!1}else if(l==="attrs"){if(!this.attrsEqual(e[l],t[l]))return!1}else if(e[l]!==t[l])return!1;return!0}attrsEqual(e,t){const l=Object.keys(e),r=Object.keys(t);if(l.length!==r.length)return!1;for(const i of l)if(i==="onclick"){if(JSON.stringify(e[i])!==JSON.stringify(t[i]))return!1}else if(e[i]!==t[i])return!1;return!0}duplicateSelected(){if(this.selectedShapes.length===0)return;const e=[],t=this.layer.getChildren();this.selectedShapes.sort((r,i)=>t.indexOf(r)-t.indexOf(i)).forEach(r=>{var o;const i=r.clone({id:this.generateUniqueId((o=r==null?void 0:r.attrs)==null?void 0:o.type)});if(i instanceof Q.Image&&r instanceof Q.Image){const a=r.image();a instanceof HTMLImageElement&&i.id()&&(i.image(a),this.updateImageCache(i.id(),a))}this.layer.add(i),e.push(i)}),this.selectedShapes.length===1?e[0].zIndex(this.selectedShapes[0].zIndex()+1):e.forEach(r=>r.moveToTop()),this.selectedShapes=e,this.transformer.nodes(e),this.record(),this.update()}getSnapPoints(e){const t=[],l=(a,c)=>[{guide:Math.round(a),snap:"start"},{guide:Math.round(a+c/2),snap:"center"},{guide:Math.round(a+c),snap:"end"}],r={vertical:l(e.x,e.width),horizontal:l(e.y,e.height)},i=this.canvas.width()/2,o=this.canvas.height()/2;return this.guides.forEach(a=>{var p;if(!a.visible())return;const c=(p=a==null?void 0:a.attrs)==null?void 0:p.type,u=c==="v-guide",d=u?r.vertical:r.horizontal,h=u?a.x()+i:a.y()+o;d.forEach(k=>{const f=Math.abs(h-k.guide);f<this.snapOffset/this.stage.scaleX()&&t.push({pos:h,diff:f,snap:k.snap,orientation:c})})}),t}setupGuideEvents(e){this.isGuide(e)&&(e.on("mouseover dragstart",t=>{e.visible()&&e.draggable()&&!this.selectionRect.isVisible()&&this.updateCursor(t)}),e.on("dragmove",()=>{e.attrs.type==="v-guide"?e.y(0):e.attrs.type==="h-guide"&&e.x(0)}),e.on("mouseout dragend",t=>{this.updateCursor(),t.type==="dragend"&&this.record()}))}updateCursor(e){var l,r;const t=this.stage.container();if(e&&this.isGuide(e.target)){const i=(r=(l=e.target)==null?void 0:l.attrs)==null?void 0:r.type;t.style.cursor=i==="v-guide"?"col-resize":"row-resize";return}this.mode==="pan"||this.panning?t.style.cursor="grab":this.mode==="zoom"?t.style.cursor=this.altKey?"zoom-out":"zoom-in":t.style.cursor="default"}toggleTextBox(e){const t=this.layer.findOne(`#${e}`);t instanceof Q.Text&&(t.getAttr("box")?(t.setAttrs({box:!1,width:void 0,height:void 0,scaleX:1,scaleY:1}),t.off("transform"),this.transformer.setAttr("boundBoxFunc",void 0)):t.getAttr("box")||(t.setAttrs({box:!0,width:t.width()*t.scaleX(),height:t.height()*t.scaleY(),scaleX:1,scaleY:1}),this.addTextBoxEventListener(t)),this.record(),this.update())}addTextBoxEventListener(e){e.off("transform"),e.on("transform",()=>{e.setAttrs({width:e.width()*e.scaleX(),height:e.height()*e.scaleY(),scaleX:1,scaleY:1})})}fitCanvas(){const t=this.stage.width()-30,l=this.stage.height()-15*2,r=Math.min(t/this.canvasWidth,l/this.canvasHeight),i=(this.stage.width()-this.canvasWidth*r)/2-this.canvas.x()*r,o=(this.stage.height()-this.canvasHeight*r)/2-this.canvas.y()*r;this.currentTween=new Q.Tween({node:this.stage,duration:.15,easing:Q.Easings.EaseInOut,scaleX:r,scaleY:r,x:i,y:o,onUpdate:()=>{this.zoomFactor=this.stage.scaleX(),this.updateGuidePos()},onFinish:()=>{this.currentTween=void 0}}).play()}moveSelectedShapes(e,t){this.mode!=="default"||this.selectedShapes.length===0||(this.selectedShapes.forEach(l=>{l.draggable()&&l.position({x:l.x()+e,y:l.y()+t})}),this.update())}async updateAttr(e,t,l,r=!1){const i=this.layer.findOne(`#${e}`);if(!i)return;const o=i.attrs,a=o==null?void 0:o.type;switch(!0){case(t==="src"&&i instanceof Q.Image):await this.updateImage(i,l,!0);break;case(t==="icon"&&i instanceof Q.Image):i.setAttr("icon",l),await this.updateIcon(i);break;case(a==="state-icon"&&t==="entity_id"&&i instanceof Q.Image):l.trim()!==""?(i.setAttr("entity_id",l),this.updateStateIcon(i,void 0)):(i.setAttrs({entity_id:"",icon:le["state-icon"]}),await this.updateIcon(i));break;case(a==="state-icon"&&t==="color"&&i instanceof Q.Image):i.setAttr("color",l),this.updateStateIcon(i,void 0);break;case(a==="state-label"&&t==="entity_id"&&i instanceof Q.Text):i.setAttr("entity_id",l),this.updateStateLabel(i,void 0);break;case(a==="icon"&&t==="color"&&i instanceof Q.Image):i.setAttr("color",l),this.updateIconColor(i,l);break;case typeof i.getAttr(t)=="number":{const c=parseFloat(l);if(!isNaN(c))if((t==="scaleX"||t==="scaleY")&&this.transformer.keepRatio())i.setAttrs({scaleX:c,scaleY:c});else if(t==="opacity"){const u=Math.max(0,Math.min(100,c));i.setAttr(t,u/100)}else i.setAttr(t,c);break}default:i.setAttr(t,l);break}this.transformer&&i instanceof Q.Text&&this.transformer.forceUpdate(),r||this.record(),this.update()}toggleVisibility(e){(e?[this.layer.findOne(`#${e}`)]:this.selectedShapes).forEach(l=>{l&&l.visible(!l.visible())}),this.transformer.nodes(this.selectedShapes.filter(l=>l.visible()&&l.draggable()&&!this.isGuide(l))),this.record(),this.update()}toggleDraggable(e){const l=(e?[this.layer.findOne(`#${e}`)]:this.selectedShapes).filter(r=>r instanceof Q.Shape||r instanceof Q.Group);if(l.length){const r=!l[0].draggable();l.forEach(i=>{i.draggable(r),i.listening(r)}),this.transformer.nodes(r?l.filter(i=>i.visible()):[]),this.record(),this.update()}}toggleKeepRatio(){this.transformer&&(this.transformer.keepRatio(!this.transformer.keepRatio()),this.update())}handleElementClick(e,t){const{shiftKey:l,ctrlKey:r,metaKey:i}=e;if(l&&this.selectedShapes.length>0){const o=this.layer.findOne(`#${this.selectedShapes[0].id()}`),a=this.layer.findOne(`#${t}`);if(!o&&!a)return;const c=this.layer.getChildren().map(h=>h),u=c.indexOf(o),d=c.indexOf(a);this.selectedShapes=c.slice(Math.min(u,d),Math.max(u,d)+1)}else if(r||i){const o=this.layer.findOne(`#${t}`);if(!o)return;const a=this.selectedShapes.indexOf(o);a>-1?this.selectedShapes.splice(a,1):this.selectedShapes.push(o)}else this.selectShapesById([t]);this.transformer.nodes(this.selectedShapes.filter(o=>o.visible()&&o.draggable()&&!this.isGuide(o))),this.update()}selectShapesById(e){this.selectedShapes=e.map(t=>this.layer.findOne(`#${t}`)).filter(t=>t instanceof Q.Shape||t instanceof Q.Group),this.transformer.nodes(this.selectedShapes.filter(t=>t.visible()&&t.draggable()&&!this.isGuide(t))),this.update()}selectAll(){this.selectedShapes=this.layer.getChildren(e=>e instanceof Q.Shape||e instanceof Q.Group),this.transformer.nodes(this.selectedShapes.filter(e=>e.visible()&&e.draggable()&&!this.isGuide(e))),this.update()}deselectAll(){this.selectedShapes=[],this.transformer.nodes([])}deleteSelected(){this.selectedShapes.forEach(e=>{e.destroy()}),this.deselectAll(),this.record(),this.update()}async reorderElements(e){e.forEach((t,l)=>{const r=this.layer.findOne(`#${t}`);r&&r.zIndex(this.layer.children.length-1-l)}),await ot(),this.record(),this.update()}updateRotationSnaps(){const e=[0,15,30,45,60,75,90,105,120,135,150,165,180,195,210,225,240,255,270,285,300,315,330,345];this.transformer.rotationSnaps(this.shiftPressed?e:[])}handleGroup(){this.selectedShapes.length>1?this.group():this.selectedShapes.length===1&&this.selectedShapes[0]instanceof Q.Group&&this.ungroup()}group(){const e=this.selectedShapes.filter(r=>!this.isGuide(r)).sort((r,i)=>this.layer.children.indexOf(r)-this.layer.children.indexOf(i));if(e.length<2)return;const t=new Q.Group({id:this.generateUniqueId("group"),type:"group",name:"Group",draggable:!0});let l=1/0;e.forEach(r=>{l=Math.min(l,this.layer.children.indexOf(r)),r.setAttr("prevDraggable",r.draggable()),r.draggable(!1),r.remove(),t.add(r)}),this.layer.add(t),t.zIndex(l),this.selectedShapes=[t],this.transformer.nodes([t]),this.record(),this.update()}ungroup(){if(this.selectedShapes.length!==1&&!(this.selectedShapes[0]instanceof Q.Group))return;const e=[],t=this.selectedShapes[0],l=this.layer.children.indexOf(t);t.getChildren().map(r=>r).forEach((r,i)=>{var o;r.setAttrs({id:this.generateUniqueId((o=r==null?void 0:r.attrs)==null?void 0:o.type),draggable:!!r.getAttr("prevDraggable"),prevDraggable:void 0}),this.layer.add(r),r.zIndex(l+i),e.push(r)}),t.destroy(),this.selectedShapes=e,this.transformer.nodes(e),this.record(),this.update()}setMode(e){this.mode=e,e==="pan"?this.startPan():this.stopPan(),this.update()}startPan(){this.panning=!0,this.stage.draggable(!0),this.layer.setAttr("listening",!1),this.selectionLayer.setAttr("listening",!1),this.updateCursor()}stopPan(){this.panning=!1,this.stage.draggable(!1),this.layer.setAttr("listening",this.mode==="default"),this.selectionLayer.setAttr("listening",this.mode==="default"),this.updateCursor()}setZoom(e,t){this.currentTween&&(this.currentTween.finish(),this.currentTween=void 0);let l;if(e==="reset")l=1;else{const i=this.zoomFactor*Math.exp(.4*(e==="in"?1:-1));l=Math.exp(Math.min(Math.max(Math.log(i),Math.log(this.minZoom)),Math.log(this.maxZoom)))}this.currentTween=new Q.Tween({node:this.stage,duration:.15,easing:Q.Easings.StrongEaseOut,x:t.x-(t.x-this.stage.x())*(l/this.zoomFactor),y:t.y-(t.y-this.stage.y())*(l/this.zoomFactor),scaleX:l,scaleY:l,onUpdate:()=>{this.zoomFactor=this.stage.scaleX(),this.updateGuidePos()},onFinish:()=>{this.currentTween=void 0}}).play()}zoomToArea(e){if(this.altKey)return;e={x:(e.x-this.stage.x())/this.zoomFactor,y:(e.y-this.stage.y())/this.zoomFactor,width:e.width/this.zoomFactor,height:e.height/this.zoomFactor};const t=e.x+e.width/2,l=e.y+e.height/2,r=this.stage.width()/e.width,i=this.stage.height()/e.height,o=Math.min(Math.max(Math.min(r,i),this.minZoom),this.maxZoom);this.currentTween=new Q.Tween({node:this.stage,duration:.25,easing:Q.Easings.StrongEaseOut,x:this.stage.width()/2-t*o,y:this.stage.height()/2-l*o,scaleX:o,scaleY:o,onUpdate:()=>{this.zoomFactor=this.stage.scaleX(),this.updateGuidePos()},onFinish:()=>{this.currentTween=void 0}}).play()}addStateLabel(){const e=new Q.Text({type:"state-label",name:"State Label",entity_id:"",fontSize:60,fill:"#ffffff",fontStyle:"normal",fontFamily:"Inter Variable",draggable:!0});this.updateStateLabel(e,void 0),this.handleAddNode(e)}async addStateIcon(){try{const e=le["state-icon"],t="#d5d5d5",l=await this.handleSvg(void 0,e,t);if(!l)return;const{width:r,height:i,url:o}=l,a=await this.loadImage(o),c=new Q.Image({type:"state-icon",name:"State Icon",entity_id:"",icon:e,color:t,image:a,width:r,height:i,draggable:!0});this.handleAddNode(c)}catch(e){console.error("error adding state-icon:",e)}}addText(){const e=new Q.Text({type:"text",name:"Text",text:"Text",fontSize:60,fill:"#ffffff",fontFamily:"Inter Variable",draggable:!0,align:"left"});this.handleAddNode(e)}async addIcon(){try{const e=le.icon,t="#d5d5d5",l=await this.handleSvg(void 0,e,t);if(!l)return;const{width:r,height:i,url:o}=l,a=await this.loadImage(o),c=new Q.Image({type:"icon",name:"Icon",icon:e,color:t,image:a,width:r,height:i,draggable:!0});this.handleAddNode(c)}catch(e){console.error("error adding icon:",e)}}async addImage(){const e="https://demo.home-assistant.io/stub_config/t-shirt-promo.png";try{const t=await this.loadImage(e),l=new Q.Image({type:"image",name:"Image",image:t,src:e,width:t.naturalWidth||64,height:t.naturalHeight||64,draggable:!0});this.handleAddNode(l)}catch(t){console.error("error adding image:",t);const l=new Q.Image({type:"image",name:"Image",image:void 0,src:e,width:100,height:100,draggable:!0});this.handleAddNode(l),await this.updateImage(l,e,!1)}}addRectangle(){const e=new Q.Rect({type:"rectangle",name:"Rectangle",width:150,height:80,fill:"#ffffff",draggable:!0});this.handleAddNode(e)}addCircle(){const e=new Q.Circle({type:"circle",name:"Circle",radius:50,fill:"#ffffff",draggable:!0});this.handleAddNode(e)}addVerticalGuide(){const e=this.stage.height(),t=this.canvasWidth/2,l=-(e-this.canvasHeight)/2,r=e/2+this.canvasHeight/2,i=new Q.Line({type:"v-guide",points:[t,l,t,r],stroke:"#75fcfd",name:"Vertical Guide",strokeWidth:1,hitStrokeWidth:8,draggable:!0,strokeScaleEnabled:!1});this.handleAddNode(i)}addHorizontalGuide(){const e=this.stage.width(),t=this.canvasHeight/2,l=-(e-this.canvasWidth)/2,r=e/2+this.canvasWidth/2,i=new Q.Line({type:"h-guide",points:[l,t,r,t],stroke:"#75fcfd",name:"Horizontal Guide",strokeWidth:1,hitStrokeWidth:8,draggable:!0,strokeScaleEnabled:!1});this.handleAddNode(i)}handleAddNode(e){var l;const t=(l=e==null?void 0:e.attrs)==null?void 0:l.type;e.setAttrs({id:this.generateUniqueId(t)}),e instanceof Q.Circle?e.position({x:this.canvasWidth/2,y:this.canvasHeight/2}):this.isGuide(e)||e.position({x:(this.canvasWidth-e.width())/2,y:(this.canvasHeight-e.height())/2}),t==="image"&&e instanceof Q.Image&&this.fitImage(e),this.layer.add(e),this.isGuide(e)&&e instanceof Q.Line?(this.setupGuideEvents(e),this.updateGuidePos()):(this.selectedShapes=[e],this.transformer.nodes([e])),this.record(),this.update()}getElementsData(){return this.layer.getChildren().map(e=>this.getNodeData(e))}getNodeData(e){const t=this.getShapeAttrs(e);delete t.image,t.type==="state-icon"&&delete t.state_color;const l={attrs:t,className:e.getClassName()};return e instanceof Q.Group&&(l.children=e.getChildren().map(r=>this.getNodeData(r))),l}generateUniqueId(e){const t=Date.now(),l=Math.random().toString(36).slice(2,11);return`${e}-${t}-${l}`}destroyEditor(){var e;window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mouseup",this.handleMouseup),(e=this.unsubscribe)==null||e.call(this),super.destroyBase()}}function Wt(n,s,e){const t=n.slice();return t[19]=s[e],t}function qt(n,s,e){const t=n.slice();return t[22]=s[e],t}function os(n){let s,e;return s=new oe({props:{icon:n[2]?le.success:le.fail,width:"20",height:"20",color:n[2]?"#4CAF50":"#FFA500"}}),{c(){ee(s.$$.fragment)},l(t){te(s.$$.fragment,t)},m(t,l){ie(s,t,l),e=!0},p(t,l){const r={};l&4&&(r.icon=t[2]?le.success:le.fail),l&4&&(r.color=t[2]?"#4CAF50":"#FFA500"),s.$set(r)},i(t){e||(U(s.$$.fragment,t),e=!0)},o(t){F(s.$$.fragment,t),e=!1},d(t){se(s,t)}}}function cs(n){let s,e;return s=new oe({props:{icon:le.test,width:"20",height:"20"}}),{c(){ee(s.$$.fragment)},l(t){te(s.$$.fragment,t)},m(t,l){ie(s,t,l),e=!0},p:we,i(t){e||(U(s.$$.fragment,t),e=!0)},o(t){F(s.$$.fragment,t),e=!1},d(t){se(s,t)}}}function Xt(n){let s,e,t,l,r,i="Service:",o,a,c,u,d,h="Target:",p,k,f,b,_,E="Data:",G,C,H,N,w,O;return{c(){s=T("div"),e=T("div"),t=K(),l=T("div"),r=T("label"),r.textContent=i,o=K(),a=T("input"),c=K(),u=T("div"),d=T("label"),d.textContent=h,p=K(),k=T("input"),f=K(),b=T("div"),_=T("label"),_.textContent=E,G=K(),C=T("textarea"),this.h()},l(M){s=S(M,"DIV",{class:!0});var L=z(s);e=S(L,"DIV",{class:!0}),z(e).forEach(m),t=Z(L),l=S(L,"DIV",{class:!0});var Y=z(l);r=S(Y,"LABEL",{for:!0,"data-svelte-h":!0}),Ye(r)!=="svelte-19soijy"&&(r.textContent=i),o=Z(Y),a=S(Y,"INPUT",{id:!0,title:!0,type:!0,list:!0,class:!0}),Y.forEach(m),c=Z(L),u=S(L,"DIV",{class:!0});var j=z(u);d=S(j,"LABEL",{for:!0,"data-svelte-h":!0}),Ye(d)!=="svelte-wr4kj4"&&(d.textContent=h),p=Z(j),k=S(j,"INPUT",{id:!0,title:!0,type:!0,list:!0,class:!0}),j.forEach(m),f=Z(L),b=S(L,"DIV",{class:!0});var y=z(b);_=S(y,"LABEL",{for:!0,"data-svelte-h":!0}),Ye(_)!=="svelte-1in3fdk"&&(_.textContent=E),G=Z(y),C=S(y,"TEXTAREA",{id:!0,title:!0,spellcheck:!0,class:!0}),z(C).forEach(m),y.forEach(m),L.forEach(m),this.h()},h(){g(e,"class","top"),g(r,"for","service"),g(a,"id","service"),g(a,"title","Service (required)"),g(a,"type","text"),g(a,"list","serviceOptions"),a.value=n[6],a.disabled=n[3],g(a,"class","svelte-rlob41"),g(l,"class","item svelte-rlob41"),g(d,"for","target"),g(k,"id","target"),g(k,"title","Entity ID (optional)"),g(k,"type","text"),g(k,"list","entityOptions"),k.value=n[5],k.disabled=n[3],g(k,"class","svelte-rlob41"),g(u,"class","item svelte-rlob41"),g(_,"for","data"),g(C,"id","data"),g(C,"title","JSON (optional)"),C.value=n[4],C.disabled=n[3],g(C,"spellcheck","false"),g(C,"class","svelte-rlob41"),g(b,"class","item svelte-rlob41"),g(s,"class","items svelte-rlob41")},m(M,L){V(M,s,L),$(s,e),$(s,t),$(s,l),$(l,r),$(l,o),$(l,a),$(s,c),$(s,u),$(u,d),$(u,p),$(u,k),$(s,f),$(s,b),$(b,_),$(b,G),$(b,C),N=!0,w||(O=[x(a,"change",n[8]),x(k,"change",n[8]),x(C,"change",n[8])],w=!0)},p(M,L){(!N||L&64&&a.value!==M[6])&&(a.value=M[6]),(!N||L&8)&&(a.disabled=M[3]),(!N||L&32&&k.value!==M[5])&&(k.value=M[5]),(!N||L&8)&&(k.disabled=M[3]),(!N||L&16)&&(C.value=M[4]),(!N||L&8)&&(C.disabled=M[3])},i(M){N||(M&&yt(()=>{N&&(H||(H=Ze(s,mt,{duration:190,easing:Je},!0)),H.run(1))}),N=!0)},o(M){M&&(H||(H=Ze(s,mt,{duration:190,easing:Je},!1)),H.run(0)),N=!1},d(M){M&&m(s),M&&H&&H.end(),w=!1,Oe(O)}}}function Yt(n){let s,e;return{c(){s=T("option"),this.h()},l(t){s=S(t,"OPTION",{}),z(s).forEach(m),this.h()},h(){s.__value=e=n[22],We(s,s.__value)},m(t,l){V(t,s,l)},p(t,l){l&128&&e!==(e=t[22])&&(s.__value=e,We(s,s.__value))},d(t){t&&m(s)}}}function Kt(n){let s,e;return{c(){s=T("option"),this.h()},l(t){s=S(t,"OPTION",{}),z(s).forEach(m),this.h()},h(){s.__value=e=n[19],We(s,s.__value)},m(t,l){V(t,s,l)},p(t,l){l&1&&e!==(e=t[19])&&(s.__value=e,We(s,s.__value))},d(t){t&&m(s)}}}function us(n){let s,e,t,l,r,i="Action",o,a,c,u,d,h,p,k,f,b,_,E,G,C,H,N,w,O;t=new oe({props:{icon:le.tapAction,width:"20",height:"20"}}),u=new oe({props:{icon:le[n[1]?"expand":"collapse"],width:"20",height:"20"}});const M=[cs,os],L=[];function Y(v,A){return v[2]===void 0?0:1}k=Y(n),f=L[k]=M[k](n);let j=!n[1]&&Xt(n),y=Te(n[7]),P=[];for(let v=0;v<y.length;v+=1)P[v]=Yt(qt(n,y,v));let D=Te(n[0]),I=[];for(let v=0;v<D.length;v+=1)I[v]=Kt(Wt(n,D,v));return{c(){s=T("div"),e=T("div"),ee(t.$$.fragment),l=K(),r=T("h3"),r.textContent=i,o=K(),a=T("div"),c=T("button"),ee(u.$$.fragment),h=K(),p=T("button"),f.c(),_=K(),j&&j.c(),E=K(),G=T("datalist");for(let v=0;v<P.length;v+=1)P[v].c();C=K(),H=T("datalist");for(let v=0;v<I.length;v+=1)I[v].c();this.h()},l(v){s=S(v,"DIV",{class:!0});var A=z(s);e=S(A,"DIV",{class:!0});var R=z(e);te(t.$$.fragment,R),l=Z(R),r=S(R,"H3",{"data-svelte-h":!0}),Ye(r)!=="svelte-12s31lq"&&(r.textContent=i),R.forEach(m),o=Z(A),a=S(A,"DIV",{class:!0});var W=z(a);c=S(W,"BUTTON",{title:!0});var q=z(c);te(u.$$.fragment,q),q.forEach(m),h=Z(W),p=S(W,"BUTTON",{title:!0});var ce=z(p);f.l(ce),ce.forEach(m),W.forEach(m),A.forEach(m),_=Z(v),j&&j.l(v),E=Z(v),G=S(v,"DATALIST",{id:!0});var ae=z(G);for(let ge=0;ge<P.length;ge+=1)P[ge].l(ae);ae.forEach(m),C=Z(v),H=S(v,"DATALIST",{id:!0});var de=z(H);for(let ge=0;ge<I.length;ge+=1)I[ge].l(de);de.forEach(m),this.h()},h(){g(e,"class","title"),g(c,"title",d=n[1]?"Expand":"Collapse"),g(p,"title",b=n[2]===void 0?"Test":n[2]?"Success":"Open Browser Console"),p.disabled=n[3],g(a,"class","right"),g(s,"class","konva-header svelte-rlob41"),g(G,"id","serviceOptions"),g(H,"id","entityOptions")},m(v,A){V(v,s,A),$(s,e),ie(t,e,null),$(e,l),$(e,r),$(s,o),$(s,a),$(a,c),ie(u,c,null),$(a,h),$(a,p),L[k].m(p,null),V(v,_,A),j&&j.m(v,A),V(v,E,A),V(v,G,A);for(let R=0;R<P.length;R+=1)P[R]&&P[R].m(G,null);V(v,C,A),V(v,H,A);for(let R=0;R<I.length;R+=1)I[R]&&I[R].m(H,null);N=!0,w||(O=[x(p,"click",xe(n[9])),x(s,"click",n[14])],w=!0)},p(v,[A]){const R={};A&2&&(R.icon=le[v[1]?"expand":"collapse"]),u.$set(R),(!N||A&2&&d!==(d=v[1]?"Expand":"Collapse"))&&g(c,"title",d);let W=k;if(k=Y(v),k===W?L[k].p(v,A):(Be(),F(L[W],1,1,()=>{L[W]=null}),ze(),f=L[k],f?f.p(v,A):(f=L[k]=M[k](v),f.c()),U(f,1),f.m(p,null)),(!N||A&4&&b!==(b=v[2]===void 0?"Test":v[2]?"Success":"Open Browser Console"))&&g(p,"title",b),(!N||A&8)&&(p.disabled=v[3]),v[1]?j&&(Be(),F(j,1,1,()=>{j=null}),ze()):j?(j.p(v,A),A&2&&U(j,1)):(j=Xt(v),j.c(),U(j,1),j.m(E.parentNode,E)),A&128){y=Te(v[7]);let q;for(q=0;q<y.length;q+=1){const ce=qt(v,y,q);P[q]?P[q].p(ce,A):(P[q]=Yt(ce),P[q].c(),P[q].m(G,null))}for(;q<P.length;q+=1)P[q].d(1);P.length=y.length}if(A&1){D=Te(v[0]);let q;for(q=0;q<D.length;q+=1){const ce=Wt(v,D,q);I[q]?I[q].p(ce,A):(I[q]=Kt(ce),I[q].c(),I[q].m(H,null))}for(;q<I.length;q+=1)I[q].d(1);I.length=D.length}},i(v){N||(U(t.$$.fragment,v),U(u.$$.fragment,v),U(f),U(j),N=!0)},o(v){F(t.$$.fragment,v),F(u.$$.fragment,v),F(f),F(j),N=!1},d(v){v&&(m(s),m(_),m(E),m(G),m(C),m(H)),se(t),se(u),L[k].d(),j&&j.d(v),je(P,v),je(I,v),w=!1,Oe(O)}}}function ds(n,s,e){let t,l,r,i,o,a,c,u;He(n,fi,N=>e(16,a=N)),He(n,kt,N=>e(17,c=N)),He(n,Ct,N=>e(13,u=N));let{konva:d}=s,{selectedShape:h}=s,{selectedShapes:p}=s,{entityOptions:k}=s,f=!0,b,_;pt(async()=>{a&&!u&&Si(a,N=>{gt(Ct,u=N,u)})});function E(N){const w=N.target,O=w.id,M=w.value;O==="service"?e(6,t=M):O==="target"?e(5,l=M):O==="data"&&e(4,r=M),G()}function G(){if(h){let[N,w]=t.split("."),O;try{O=r?JSON.parse(r):void 0}catch(L){console.error("Invalid JSON in service data:",L)}const M={};(N==null?void 0:N.trim())!==""&&(M.domain=N.trim()),w&&w.trim()!==""&&(M.service=w.trim()),(l==null?void 0:l.trim())!==""&&(M.target={entity_id:l.trim()}),O&&Object.keys(O).length>0&&(M.data=O),M.data&&Object.keys(M.data).length===0&&delete M.data,Object.keys(M).length===0?d.updateAttr(h.attrs.id,"onclick",void 0):d.updateAttr(h.attrs.id,"onclick",M)}}async function C(){if(clearTimeout(_),_=setTimeout(()=>{e(2,b=void 0)},3500),!t){e(2,b=!1),console.error("Service not selected");return}const[N,w]=t.split(".");if(!N||!w){e(2,b=!1),console.error("Invalid service format");return}let O;if(l)if(c&&(c!=null&&c[l]))O={entity_id:l};else{e(2,b=!1),console.error("Invalid target entity:",l);return}let M;if(r.trim())try{M=JSON.parse(r)}catch(L){e(2,b=!1),console.error("Invalid JSON in service data:",L);return}try{await vi(a,N,w,M,O),e(2,b=!0),console.debug("Service call test successful")}catch(L){e(2,b=!1),console.error("Error testing service call:",L),L instanceof Error&&console.error("Error message:",L.message)}}const H=()=>{e(1,f=!f)};return n.$$set=N=>{"konva"in N&&e(10,d=N.konva),"selectedShape"in N&&e(11,h=N.selectedShape),"selectedShapes"in N&&e(12,p=N.selectedShapes),"entityOptions"in N&&e(0,k=N.entityOptions)},n.$$.update=()=>{var N,w,O,M,L,Y,j,y,P,D,I;n.$$.dirty&2048&&e(6,t=(w=(N=h==null?void 0:h.attrs)==null?void 0:N.onclick)!=null&&w.domain&&((M=(O=h==null?void 0:h.attrs)==null?void 0:O.onclick)!=null&&M.service)?`${h.attrs.onclick.domain}.${h.attrs.onclick.service}`:""),n.$$.dirty&2048&&e(5,l=((j=(Y=(L=h==null?void 0:h.attrs)==null?void 0:L.onclick)==null?void 0:Y.target)==null?void 0:j.entity_id)||""),n.$$.dirty&2048&&e(4,r=(P=(y=h==null?void 0:h.attrs)==null?void 0:y.onclick)!=null&&P.data?JSON.stringify(h.attrs.onclick.data,null,2):""),n.$$.dirty&6144&&(!h||p.length!==1)&&(e(6,t=""),e(5,l=""),e(4,r="")),n.$$.dirty&8192&&e(7,i=Object.entries(u||{}).flatMap(([v,A])=>Object.keys(A).map(R=>`${v}.${R}`)).sort((v,A)=>v.localeCompare(A))),n.$$.dirty&6144&&e(3,o=!((D=h==null?void 0:h.attrs)!=null&&D.draggable)||(p==null?void 0:p.length)!==1||["v-guide","h-guide","group"].includes((I=h==null?void 0:h.attrs)==null?void 0:I.type))},[k,f,b,o,r,l,t,i,E,C,d,h,p,u,H]}class fs extends Ve{constructor(s){super(),Fe(this,s,ds,us,Ge,{konva:10,selectedShape:11,selectedShapes:12,entityOptions:0})}}const{document:hs}=ki;function Zt(n,s,e){var r,i;const t=n.slice();t[26]=s[e];const l=(i=(r=t[5])==null?void 0:r.children)==null?void 0:i.find(function(...a){return n[23](t[26],...a)});return t[27]=l,t}function gs(n){var t,l,r;let s,e;return s=new oe({props:{icon:(r=le)==null?void 0:r[(l=(t=n[26])==null?void 0:t.attrs)==null?void 0:l.type],width:"20",height:"20"}}),{c(){ee(s.$$.fragment)},l(i){te(s.$$.fragment,i)},m(i,o){ie(s,i,o),e=!0},p(i,o){var c,u,d;const a={};o&16&&(a.icon=(d=le)==null?void 0:d[(u=(c=i[26])==null?void 0:c.attrs)==null?void 0:u.type]),s.$set(a)},i(i){e||(U(s.$$.fragment,i),e=!0)},o(i){F(s.$$.fragment,i),e=!1},d(i){se(s,i)}}}function ms(n){var c;let s,e,t,l,r,i,o,a;return r=new oe({props:{icon:(c=le)==null?void 0:c.broken,width:"20",height:"20",style:"display: none;"}}),{c(){s=T("div"),e=T("img"),l=K(),ee(r.$$.fragment),this.h()},l(u){s=S(u,"DIV",{class:!0});var d=z(s);e=S(d,"IMG",{src:!0,alt:!0,width:!0,height:!0,class:!0}),l=Z(d),te(r.$$.fragment,d),d.forEach(m),this.h()},h(){var u,d;St(e.src,t=(d=(u=n[27])==null?void 0:u.attrs)==null?void 0:d.src)||g(e,"src",t),g(e,"alt",""),g(e,"width","20"),g(e,"height","20"),g(e,"class","svelte-2i7ve4"),g(s,"class","thumbnail svelte-2i7ve4")},m(u,d){V(u,s,d),$(s,e),$(s,l),ie(r,s,null),i=!0,o||(a=[x(e,"load",ei),x(e,"error",ei)],o=!0)},p(u,d){var h,p;(!i||d&48&&!St(e.src,t=(p=(h=u[27])==null?void 0:h.attrs)==null?void 0:p.src))&&g(e,"src",t)},i(u){i||(U(r.$$.fragment,u),i=!0)},o(u){F(r.$$.fragment,u),i=!1},d(u){u&&m(s),se(r),o=!1,Oe(a)}}}function ps(n){let s,e,t,l,r;const i=[vs,_s,bs],o=[];function a(c,u){var d,h,p,k,f,b;return u&48&&(s=null),((h=(d=c[26])==null?void 0:d.attrs)==null?void 0:h.type)==="state-icon"&&!((k=(p=c[26])==null?void 0:p.attrs)!=null&&k.entity_id)?0:(s==null&&(s=!!Ii((b=(f=c[27])==null?void 0:f.attrs)==null?void 0:b.icon)),s?1:2)}return e=a(n,-1),t=o[e]=i[e](n),{c(){t.c(),l=Ue()},l(c){t.l(c),l=Ue()},m(c,u){o[e].m(c,u),V(c,l,u),r=!0},p(c,u){let d=e;e=a(c,u),e===d?o[e].p(c,u):(Be(),F(o[d],1,1,()=>{o[d]=null}),ze(),t=o[e],t?t.p(c,u):(t=o[e]=i[e](c),t.c()),U(t,1),t.m(l.parentNode,l))},i(c){r||(U(t),r=!0)},o(c){F(t),r=!1},d(c){c&&m(l),o[e].d(c)}}}function bs(n){var r,i;let s,e,t,l={ctx:n,current:null,token:null,hasCatch:!0,pending:ws,then:ks,catch:ys,value:30,blocks:[,,,]};return Ot(e=Bt((i=(r=n[27])==null?void 0:r.attrs)==null?void 0:i.icon),l),{c(){s=Ue(),l.block.c()},l(o){s=Ue(),l.block.l(o)},m(o,a){V(o,s,a),l.block.m(o,l.anchor=a),l.mount=()=>s.parentNode,l.anchor=s,t=!0},p(o,a){var c,u;n=o,l.ctx=n,a&48&&e!==(e=Bt((u=(c=n[27])==null?void 0:c.attrs)==null?void 0:u.icon))&&Ot(e,l)||mi(l,n,a)},i(o){t||(U(l.block),t=!0)},o(o){for(let a=0;a<3;a+=1){const c=l.blocks[a];F(c)}t=!1},d(o){o&&m(s),l.block.d(o),l.token=null,l=null}}}function _s(n){var t,l;let s,e;return s=new oe({props:{icon:(l=(t=n[27])==null?void 0:t.attrs)==null?void 0:l.icon,width:"20",height:"20"}}),{c(){ee(s.$$.fragment)},l(r){te(s.$$.fragment,r)},m(r,i){ie(s,r,i),e=!0},p(r,i){var a,c;const o={};i&48&&(o.icon=(c=(a=r[27])==null?void 0:a.attrs)==null?void 0:c.icon),s.$set(o)},i(r){e||(U(s.$$.fragment,r),e=!0)},o(r){F(s.$$.fragment,r),e=!1},d(r){se(s,r)}}}function vs(n){let s,e;return s=new oe({props:{icon:"mdi:lightbulb",width:"20",height:"20"}}),{c(){ee(s.$$.fragment)},l(t){te(s.$$.fragment,t)},m(t,l){ie(s,t,l),e=!0},p:we,i(t){e||(U(s.$$.fragment,t),e=!0)},o(t){F(s.$$.fragment,t),e=!1},d(t){se(s,t)}}}function ys(n){let s,e;return s=new oe({props:{icon:le.broken,width:"20",height:"20"}}),{c(){ee(s.$$.fragment)},l(t){te(s.$$.fragment,t)},m(t,l){ie(s,t,l),e=!0},p:we,i(t){e||(U(s.$$.fragment,t),e=!0)},o(t){F(s.$$.fragment,t),e=!1},d(t){se(s,t)}}}function ks(n){let s,e;return s=new oe({props:{icon:n[30],width:"20",height:"20"}}),{c(){ee(s.$$.fragment)},l(t){te(s.$$.fragment,t)},m(t,l){ie(s,t,l),e=!0},p(t,l){const r={};l&48&&(r.icon=t[30]),s.$set(r)},i(t){e||(U(s.$$.fragment,t),e=!0)},o(t){F(s.$$.fragment,t),e=!1},d(t){se(s,t)}}}function ws(n){let s,e;return s=new oe({props:{icon:le.broken,width:"20",height:"20"}}),{c(){ee(s.$$.fragment)},l(t){te(s.$$.fragment,t)},m(t,l){ie(s,t,l),e=!0},p:we,i(t){e||(U(s.$$.fragment,t),e=!0)},o(t){F(s.$$.fragment,t),e=!1},d(t){se(s,t)}}}function Es(n){var o,a;let s,e=((a=(o=n[26])==null?void 0:o.attrs)==null?void 0:a.name)+"",t,l,r;function i(){return n[18](n[26])}return{c(){s=T("span"),t=Me(e),this.h()},l(c){s=S(c,"SPAN",{class:!0});var u=z(s);t=De(u,e),u.forEach(m),this.h()},h(){g(s,"class","name editable svelte-2i7ve4")},m(c,u){V(c,s,u),$(s,t),l||(r=x(s,"dblclick",i),l=!0)},p(c,u){var d,h;n=c,u&16&&e!==(e=((h=(d=n[26])==null?void 0:d.attrs)==null?void 0:h.name)+"")&&Qe(t,e)},d(c){c&&m(s),l=!1,r()}}}function $s(n){let s,e,t,l,r;function i(...o){return n[16](n[26],...o)}return{c(){s=T("input"),this.h()},l(o){s=S(o,"INPUT",{id:!0,type:!0,class:!0}),this.h()},h(){var o,a,c;g(s,"id",e=(o=n[26])==null?void 0:o.id),g(s,"type","text"),g(s,"class","editable svelte-2i7ve4"),s.value=t=(c=(a=n[26])==null?void 0:a.attrs)==null?void 0:c.name,s.autofocus=!0},m(o,a){V(o,s,a),s.focus(),l||(r=[x(s,"keydown",i),x(s,"blur",n[17]),x(s,"click",xe(n[12]))],l=!0)},p(o,a){var c,u,d;n=o,a&16&&e!==(e=(c=n[26])==null?void 0:c.id)&&g(s,"id",e),a&16&&t!==(t=(d=(u=n[26])==null?void 0:u.attrs)==null?void 0:d.name)&&s.value!==t&&(s.value=t)},d(o){o&&m(s),l=!1,Oe(r)}}}function Jt(n){let s,e,t,l,r;e=new oe({props:{icon:le.locked,width:"20",height:"20"}});function i(){return n[19](n[26])}return{c(){s=T("button"),ee(e.$$.fragment),this.h()},l(o){s=S(o,"BUTTON",{class:!0,title:!0});var a=z(s);te(e.$$.fragment,a),a.forEach(m),this.h()},h(){g(s,"class","inline-lock svelte-2i7ve4"),g(s,"title","Unlock")},m(o,a){V(o,s,a),ie(e,s,null),t=!0,l||(r=x(s,"click",xe(i)),l=!0)},p(o,a){n=o},i(o){t||(U(e.$$.fragment,o),t=!0)},o(o){F(e.$$.fragment,o),t=!1},d(o){o&&m(s),se(e),l=!1,r()}}}function Qt(n,s){var y,P,D,I,v;let e,t,l,r,i,o,a,c,u,d,h,p,k=we,f,b,_;l=new oe({props:{icon:(D=le)==null?void 0:D[((P=(y=s[26])==null?void 0:y.attrs)==null?void 0:P.visible)===!1?"hidden":"visible"],width:"20",height:"20"}});function E(){return s[15](s[26])}const G=[ps,ms,gs],C=[];function H(A,R){var W,q,ce,ae,de,ge;return((q=(W=A[26])==null?void 0:W.attrs)==null?void 0:q.type)==="icon"||((ae=(ce=A[26])==null?void 0:ce.attrs)==null?void 0:ae.type)==="state-icon"?0:((ge=(de=A[26])==null?void 0:de.attrs)==null?void 0:ge.type)==="image"?1:2}a=H(s),c=C[a]=G[a](s);function N(A,R){var W;return A[3]===((W=A[26])==null?void 0:W.id)?$s:Es}let w=N(s),O=w(s),M=!((v=(I=s[26])==null?void 0:I.attrs)!=null&&v.draggable)&&Jt(s);function L(){return s[20](s[26])}function Y(...A){return s[21](s[26],...A)}function j(...A){return s[22](s[26],...A)}return{key:n,first:null,c(){e=T("div"),t=T("button"),ee(l.$$.fragment),i=K(),o=T("span"),c.c(),u=K(),O.c(),d=K(),M&&M.c(),h=K(),this.h()},l(A){e=S(A,"DIV",{class:!0});var R=z(e);t=S(R,"BUTTON",{class:!0,title:!0});var W=z(t);te(l.$$.fragment,W),W.forEach(m),i=Z(R),o=S(R,"SPAN",{class:!0});var q=z(o);c.l(q),q.forEach(m),u=Z(R),O.l(R),d=Z(R),M&&M.l(R),h=Z(R),R.forEach(m),this.h()},h(){var A,R,W;g(t,"class","visibility svelte-2i7ve4"),g(t,"title",r=((R=(A=s[26])==null?void 0:A.attrs)==null?void 0:R.visible)===!1?"Show":"Hide"),g(o,"class","icon svelte-2i7ve4"),g(e,"class","item svelte-2i7ve4"),_e(e,"selected",(W=s[2])==null?void 0:W.some(j)),this.first=e},m(A,R){V(A,e,R),$(e,t),ie(l,t,null),$(e,i),$(e,o),C[a].m(o,null),$(e,u),O.m(e,null),$(e,d),M&&M.m(e,null),$(e,h),f=!0,b||(_=[x(t,"click",xe(E)),x(e,"dragstart",L),x(e,"click",Y)],b=!0)},p(A,R){var ce,ae,de,ge,me,ye,Ce,Ie;s=A;const W={};R&16&&(W.icon=(de=le)==null?void 0:de[((ae=(ce=s[26])==null?void 0:ce.attrs)==null?void 0:ae.visible)===!1?"hidden":"visible"]),l.$set(W),(!f||R&16&&r!==(r=((me=(ge=s[26])==null?void 0:ge.attrs)==null?void 0:me.visible)===!1?"Show":"Hide"))&&g(t,"title",r);let q=a;a=H(s),a===q?C[a].p(s,R):(Be(),F(C[q],1,1,()=>{C[q]=null}),ze(),c=C[a],c?c.p(s,R):(c=C[a]=G[a](s),c.c()),U(c,1),c.m(o,null)),w===(w=N(s))&&O?O.p(s,R):(O.d(1),O=w(s),O&&(O.c(),O.m(e,d))),(Ce=(ye=s[26])==null?void 0:ye.attrs)!=null&&Ce.draggable?M&&(Be(),F(M,1,1,()=>{M=null}),ze()):M?(M.p(s,R),R&16&&U(M,1)):(M=Jt(s),M.c(),U(M,1),M.m(e,h)),(!f||R&20)&&_e(e,"selected",(Ie=s[2])==null?void 0:Ie.some(j))},r(){p=e.getBoundingClientRect()},f(){wi(e),k()},a(){k(),k=Ei(e,p,$i,{duration:0})},i(A){f||(U(l.$$.fragment,A),U(c),U(M),f=!0)},o(A){F(l.$$.fragment,A),F(c),F(M),f=!1},d(A){A&&m(e),se(l),C[a].d(),O.d(),M&&M.d(),b=!1,Oe(_)}}}function Is(n){var j,y,P,D;let s,e,t,l,r,i,o="Elements",a,c,u,d,h,p,k,f,b,_,E,G,C=[],H=new Map,N,w,O,M;l=new oe({props:{icon:le.elements,width:"20",height:"20"}}),d=new oe({props:{icon:(P=le)==null?void 0:P[(y=(j=n[1])==null?void 0:j.attrs)!=null&&y.draggable?"unlocked":"locked"],width:"20",height:"20"}}),b=new oe({props:{icon:(D=le)==null?void 0:D.delete,width:"20",height:"20"}});let L=Te(n[4]);const Y=I=>I[26].id;for(let I=0;I<L.length;I+=1){let v=Zt(n,L,I),A=Y(v);H.set(A,C[I]=Qt(A,v))}return{c(){s=K(),e=T("div"),t=T("div"),ee(l.$$.fragment),r=K(),i=T("h3"),i.textContent=o,a=K(),c=T("div"),u=T("button"),ee(d.$$.fragment),k=K(),f=T("button"),ee(b.$$.fragment),E=K(),G=T("div");for(let I=0;I<C.length;I+=1)C[I].c();this.h()},l(I){s=Z(I),e=S(I,"DIV",{class:!0});var v=z(e);t=S(v,"DIV",{class:!0});var A=z(t);te(l.$$.fragment,A),r=Z(A),i=S(A,"H3",{"data-svelte-h":!0}),Ye(i)!=="svelte-4oj3bt"&&(i.textContent=o),A.forEach(m),a=Z(v),c=S(v,"DIV",{class:!0});var R=z(c);u=S(R,"BUTTON",{title:!0});var W=z(u);te(d.$$.fragment,W),W.forEach(m),k=Z(R),f=S(R,"BUTTON",{title:!0});var q=z(f);te(b.$$.fragment,q),q.forEach(m),R.forEach(m),v.forEach(m),E=Z(I),G=S(I,"DIV",{class:!0});var ce=z(G);for(let ae=0;ae<C.length;ae+=1)C[ae].l(ce);ce.forEach(m),this.h()},h(){var I,v;g(t,"class","title"),g(u,"title",h=((v=(I=n[1])==null?void 0:I.attrs)==null?void 0:v.draggable)!==!1?"Lock":"Unlock"),u.disabled=p=!n[1],g(f,"title","Delete"),f.disabled=_=!n[1],g(c,"class","right"),g(e,"class","konva-header svelte-2i7ve4"),g(G,"class","items svelte-2i7ve4")},m(I,v){V(I,s,v),V(I,e,v),$(e,t),ie(l,t,null),$(t,r),$(t,i),$(e,a),$(e,c),$(c,u),ie(d,u,null),$(c,k),$(c,f),ie(b,f,null),V(I,E,v),V(I,G,v);for(let A=0;A<C.length;A+=1)C[A]&&C[A].m(G,null);w=!0,O||(M=[x(hs,"pointerdown",n[8]),x(u,"click",n[13]),x(f,"click",n[14]),ri(N=yi.call(null,G,{flipDurationMs:0,dropTargetStyle:{},transformDraggedElement:xt,items:n[4]})),x(G,"consider",n[7]),x(G,"finalize",n[7])],O=!0)},p(I,[v]){var R,W,q,ce,ae;const A={};if(v&2&&(A.icon=(q=le)==null?void 0:q[(W=(R=I[1])==null?void 0:R.attrs)!=null&&W.draggable?"unlocked":"locked"]),d.$set(A),(!w||v&2&&h!==(h=((ae=(ce=I[1])==null?void 0:ce.attrs)==null?void 0:ae.draggable)!==!1?"Lock":"Unlock"))&&g(u,"title",h),(!w||v&2&&p!==(p=!I[1]))&&(u.disabled=p),(!w||v&2&&_!==(_=!I[1]))&&(f.disabled=_),v&1597){L=Te(I[4]),Be();for(let de=0;de<C.length;de+=1)C[de].r();C=hi(C,v,Y,1,I,L,H,G,gi,Qt,null,Zt);for(let de=0;de<C.length;de+=1)C[de].a();ze()}N&&ht(N.update)&&v&16&&N.update.call(null,{flipDurationMs:0,dropTargetStyle:{},transformDraggedElement:xt,items:I[4]})},i(I){if(!w){U(l.$$.fragment,I),U(d.$$.fragment,I),U(b.$$.fragment,I);for(let v=0;v<L.length;v+=1)U(C[v]);w=!0}},o(I){F(l.$$.fragment,I),F(d.$$.fragment,I),F(b.$$.fragment,I);for(let v=0;v<C.length;v+=1)F(C[v]);w=!1},d(I){I&&(m(s),m(e),m(E),m(G)),se(l),se(d),se(b);for(let v=0;v<C.length;v+=1)C[v].d();O=!1,Oe(M)}}}function xt(n){n&&Object.assign(n.style,{outline:"none",opacity:"0.8"})}function ei(n){const s=n==null?void 0:n.currentTarget,e=s==null?void 0:s.nextElementSibling,t=(n==null?void 0:n.type)==="error";s.style.display=t?"none":"block",e.style.display=t?"block":"none"}function As(n,s,e){let t,l,r;He(n,ct,y=>e(25,t=y)),He(n,Xe,y=>e(5,l=y));let{konva:i}=s,{selectedShape:o}=s,{selectedShapes:a}=s,c,u,d;const h=Ni([Xe,ct],([y,P],D)=>{P||D(y)});He(n,h,y=>e(11,r=y));async function p(y){gt(ct,t=!0,t);const P=y.detail.info.id,D=y.detail.items;if(e(4,d=D),u||(u=[...l.children].reverse().map(I=>{var v;return(v=I==null?void 0:I.attrs)==null?void 0:v.id})),y.type==="consider"&&!a.some(I=>I.attrs.id===P)&&i.selectShapesById([P]),y.type==="finalize"){const I=a.map(R=>{var W;return(W=R==null?void 0:R.attrs)==null?void 0:W.id}),v=D.filter(R=>{var W;return!((W=R==null?void 0:R.id)!=null&&W.startsWith("id:dnd-shadow-placeholder"))});if(I.includes(P)){const R=u.filter(ae=>I.includes(ae)).map(ae=>v.find(de=>de.id===ae)).filter(ae=>ae!==void 0),W=v.filter(ae=>!I.includes(ae.id)),q=v.findIndex(ae=>ae.id===P);let ce;q<W.length?ce=[...W.slice(0,q),...R,...W.slice(q)]:ce=[...W,...R],e(4,d=ce),await ot(),i.selectShapesById(I)}else e(4,d=v),await ot(),i.selectShapesById([P]);i.reorderElements(d.map(R=>R==null?void 0:R.id)),gt(ct,t=!1,t),u=void 0}}function k(y){if(!c)return;const P=document.getElementById(c);P&&P.contains(y.target)||(P&&i.updateAttr(c,"name",P.value),e(3,c=void 0))}function f(y,P){var I;const D=y.target;y.key==="Enter"||y.key==="Tab"?(i.updateAttr(P.attrs.id,"name",D.value),e(3,c=void 0)):y.key==="Escape"&&(D.value=(I=P==null?void 0:P.attrs)==null?void 0:I.name,e(3,c=void 0))}function b(y){i.selectShapesById([y])}function _(y){ui.call(this,n,y)}const E=()=>i.toggleDraggable(),G=()=>i.deleteSelected(),C=y=>{var P;return i.toggleVisibility((P=y==null?void 0:y.attrs)==null?void 0:P.id)},H=(y,P)=>f(P,y),N=()=>e(3,c=void 0),w=y=>e(3,c=y==null?void 0:y.id),O=y=>{var P;return i.toggleDraggable((P=y==null?void 0:y.attrs)==null?void 0:P.id)},M=y=>{var P;return b((P=y==null?void 0:y.attrs)==null?void 0:P.id)},L=async(y,P)=>{var D,I,v;((document==null?void 0:document.activeElement)instanceof HTMLInputElement||(document==null?void 0:document.activeElement)instanceof HTMLTextAreaElement)&&((I=(D=document==null?void 0:document.activeElement)==null?void 0:D.blur)==null||I.call(D),await ot()),i.handleElementClick(P,(v=y==null?void 0:y.attrs)==null?void 0:v.id)},Y=(y,P)=>{var D,I;return((D=P==null?void 0:P.attrs)==null?void 0:D.id)===((I=y==null?void 0:y.attrs)==null?void 0:I.id)},j=(y,P)=>{var D,I;return((D=P==null?void 0:P.attrs)==null?void 0:D.id)===((I=y==null?void 0:y.attrs)==null?void 0:I.id)};return n.$$set=y=>{"konva"in y&&e(0,i=y.konva),"selectedShape"in y&&e(1,o=y.selectedShape),"selectedShapes"in y&&e(2,a=y.selectedShapes)},n.$$.update=()=>{n.$$.dirty&2048&&e(4,d=r!=null&&r.children?[...r.children].reverse().map((y,P)=>{var D;return{...y,id:((D=y==null?void 0:y.attrs)==null?void 0:D.id)||`layer-${P}`}}):[])},[i,o,a,c,d,l,h,p,k,f,b,r,_,E,G,C,H,N,w,O,M,L,Y,j]}class Ts extends Ve{constructor(s){super(),Fe(this,s,As,Is,Ge,{konva:0,selectedShape:1,selectedShapes:2})}}function ti(n,s,e){const t=n.slice();return t[5]=s[e],t}function ii(n,s,e){const t=n.slice();return t[8]=s[e][0],t[9]=s[e][1],t}function si(n){let s,e,t=n[8]+"",l,r,i=n[9]+"",o;return{c(){s=T("li"),e=T("kbd"),l=Me(t),r=K(),o=Me(i),this.h()},l(a){s=S(a,"LI",{class:!0});var c=z(s);e=S(c,"KBD",{class:!0});var u=z(e);l=De(u,t),u.forEach(m),r=Z(c),o=De(c,i),c.forEach(m),this.h()},h(){g(e,"class","svelte-1507olj"),g(s,"class","svelte-1507olj")},m(a,c){V(a,s,c),$(s,e),$(e,l),$(s,r),$(s,o)},p:we,d(a){a&&m(s)}}}function li(n){let s,e,t=n[5].title+"",l,r,i,o=Te(Object.entries(n[5].items)),a=[];for(let c=0;c<o.length;c+=1)a[c]=si(ii(n,o,c));return{c(){s=T("div"),e=T("h2"),l=Me(t),r=K(),i=T("ul");for(let c=0;c<a.length;c+=1)a[c].c();this.h()},l(c){s=S(c,"DIV",{class:!0});var u=z(s);e=S(u,"H2",{class:!0});var d=z(e);l=De(d,t),d.forEach(m),r=Z(u),i=S(u,"UL",{class:!0});var h=z(i);for(let p=0;p<a.length;p+=1)a[p].l(h);h.forEach(m),u.forEach(m),this.h()},h(){g(e,"class","svelte-1507olj"),g(i,"class","svelte-1507olj"),g(s,"class","section svelte-1507olj")},m(c,u){V(c,s,u),$(s,e),$(e,l),$(s,r),$(s,i);for(let d=0;d<a.length;d+=1)a[d]&&a[d].m(i,null)},p(c,u){if(u&2){o=Te(Object.entries(c[5].items));let d;for(d=0;d<o.length;d+=1){const h=ii(c,o,d);a[d]?a[d].p(h,u):(a[d]=si(h),a[d].c(),a[d].m(i,null))}for(;d<a.length;d+=1)a[d].d(1);a.length=o.length}},d(c){c&&m(s),je(a,c)}}}function Ss(n){let s,e,t,l,r,i,o,a,c,u,d=Te(n[1]),h=[];for(let p=0;p<d.length;p+=1)h[p]=li(ti(n,d,p));return i=new oe({props:{icon:"mingcute:close-fill",width:"20",height:"20"}}),{c(){s=K(),e=T("button"),t=T("div");for(let p=0;p<h.length;p+=1)h[p].c();l=K(),r=T("button"),ee(i.$$.fragment),this.h()},l(p){s=Z(p),e=S(p,"BUTTON",{class:!0});var k=z(e);t=S(k,"DIV",{class:!0});var f=z(t);for(let _=0;_<h.length;_+=1)h[_].l(f);l=Z(f),r=S(f,"BUTTON",{class:!0});var b=z(r);te(i.$$.fragment,b),b.forEach(m),f.forEach(m),k.forEach(m),this.h()},h(){g(r,"class","close-overlay svelte-1507olj"),g(t,"class","container svelte-1507olj"),g(e,"class","svelte-1507olj")},m(p,k){V(p,s,k),V(p,e,k),$(e,t);for(let f=0;f<h.length;f+=1)h[f]&&h[f].m(t,null);$(t,l),$(t,r),ie(i,r,null),a=!0,c||(u=[x(document,"keydown",xe(n[3])),x(e,"click",n[2])],c=!0)},p(p,[k]){if(n=p,k&2){d=Te(n[1]);let f;for(f=0;f<d.length;f+=1){const b=ti(n,d,f);h[f]?h[f].p(b,k):(h[f]=li(b),h[f].c(),h[f].m(t,l))}for(;f<h.length;f+=1)h[f].d(1);h.length=d.length}},i(p){a||(U(i.$$.fragment,p),p&&yt(()=>{a&&(o||(o=Ze(e,Mt,{duration:n[0],easing:Je},!0)),o.run(1))}),a=!0)},o(p){F(i.$$.fragment,p),p&&(o||(o=Ze(e,Mt,{duration:n[0],easing:Je},!1)),o.run(0)),a=!1},d(p){p&&(m(s),m(e)),je(h,p),se(i),p&&o&&o.end(),c=!1,Oe(u)}}}function Ns(n,s,e){let t;He(n,pi,a=>e(0,t=a));let{showHelp:l}=s;const r=[{title:"Tool",items:{V:"Select",H:"Pan",Z:"Zoom",Space:"Quick pan (hold)"}},{title:"Select",items:{"Cmd + Click":"Multi-select","Shift + Click":"Range select","Cmd + A":"Select all elements"}},{title:"Delete",items:{Backspace:"Remove selected element(s)",Delete:"Remove selected element(s)"}},{title:"Position",items:{Arrow:"Move selected element(s)","Shift + Drag":"Constrain to axis"}},{title:"Resize",items:{"Shift + Drag":"Free resize (drag handle)","Alt + Drag":"Resize from center (drag handle)"}},{title:"Rotate",items:{"Shift + Drag":"Snap increment (rotation handle)"}},{title:"Zoom",items:{"Alt + Click":"Zoom out (zoom tool)","Double-click Pan (H)":"Fit canvas","Double-click Zoom (Z)":"Reset zoom"}},{title:"Lock",items:{"Cmd + L":"Toggle lock"}},{title:"Visibility",items:{"Cmd + ,":"Toggle visibility"}},{title:"Duplicate",items:{"Cmd + J":"Duplicate element(s)","Alt + Drag":"Duplicate element(s) (select tool)"}},{title:"Group",items:{"Cmd + G":"Group elements / Ungroup group"}},{title:"History",items:{"Cmd + Z":"Undo","Cmd + Shift + Z":"Redo"}}];function i(){e(4,l=!1)}function o(a){a.key==="Escape"&&i()}return n.$$set=a=>{"showHelp"in a&&e(4,l=a.showHelp)},[t,r,i,o,l]}class Cs extends Ve{constructor(s){super(),Fe(this,s,Ns,Ss,Ge,{showHelp:4})}}function ni(n){let s,e;return s=new Ci({props:{size:"large",$$slots:{title:[Ms],default:[Os]},$$scope:{ctx:n}}}),{c(){ee(s.$$.fragment)},l(t){te(s.$$.fragment,t)},m(t,l){ie(s,t,l),e=!0},p(t,l){const r={};l&268443645&&(r.$$scope={dirty:l,ctx:t}),s.$set(r)},i(t){e||(U(s.$$.fragment,t),e=!0)},o(t){F(s.$$.fragment,t),e=!1},d(t){se(s,t)}}}function ai(n){let s,e,t;function l(i){n[24](i)}let r={};return n[9]!==void 0&&(r.showHelp=n[9]),s=new Cs({props:r}),Ke.push(()=>ft(s,"showHelp",l)),{c(){ee(s.$$.fragment)},l(i){te(s.$$.fragment,i)},m(i,o){ie(s,i,o),t=!0},p(i,o){const a={};!e&&o&512&&(e=!0,a.showHelp=i[9],dt(()=>e=!1)),s.$set(a)},i(i){t||(U(s.$$.fragment,i),t=!0)},o(i){F(s.$$.fragment,i),t=!1},d(i){se(s,i)}}}function Os(n){let s,e,t,l,r,i,o,a,c,u,d,h,p,k,f,b,_,E,G,C,H,N,w,O,M,L,Y,j,y=`3rem 1fr 0px ${n[7]}px`,P,D,I,v,A,R;const W=[n[10],{setAttribute:n[13]}];function q(X){n[19](X)}let ce={};for(let X=0;X<W.length;X+=1)ce=nt(ce,W[X]);n[9]!==void 0&&(ce.showHelp=n[9]),l=new Hi({props:ce}),Ke.push(()=>ft(l,"showHelp",q));const ae=[n[10],{setAttribute:n[13]},{entityOptions:n[11]}];let de={};for(let X=0;X<ae.length;X+=1)de=nt(de,ae[X]);a=new Xi({props:de}),d=new Zi({props:{konva:n[2]}});function ge(X){n[22](X)}function me(X){n[23](X)}let ye={container:n[5]};n[8]!==void 0&&(ye.resizing=n[8]),n[7]!==void 0&&(ye.panelsWidth=n[7]),b=new is({props:ye}),Ke.push(()=>ft(b,"resizing",ge)),Ke.push(()=>ft(b,"panelsWidth",me));const Ce=[n[10],{setAttribute:n[13]}];let Ie={};for(let X=0;X<Ce.length;X+=1)Ie=nt(Ie,Ce[X]);H=new rs({props:Ie});const Le=[n[10],{entityOptions:n[11]}];let ke={};for(let X=0;X<Le.length;X+=1)ke=nt(ke,Le[X]);O=new fs({props:ke});const Se=[n[10]];let Ae={};for(let X=0;X<Se.length;X+=1)Ae=nt(Ae,Se[X]);Y=new Ts({props:Ae});let re=n[9]&&ai(n);return I=new Oi({props:{sel:n[0]}}),{c(){s=T("div"),e=T("div"),t=T("div"),ee(l.$$.fragment),i=K(),o=T("div"),ee(a.$$.fragment),c=K(),u=T("div"),ee(d.$$.fragment),h=K(),p=T("div"),k=K(),f=T("div"),ee(b.$$.fragment),G=K(),C=T("div"),ee(H.$$.fragment),N=K(),w=T("div"),ee(O.$$.fragment),M=K(),L=T("div"),ee(Y.$$.fragment),j=K(),re&&re.c(),P=K(),D=T("div"),ee(I.$$.fragment),this.h()},l(X){s=S(X,"DIV",{class:!0});var he=z(s);e=S(he,"DIV",{"data-exclude-drag-modal":!0,class:!0});var pe=z(e);t=S(pe,"DIV",{class:!0});var ve=z(t);te(l.$$.fragment,ve),ve.forEach(m),i=Z(pe),o=S(pe,"DIV",{class:!0});var J=z(o);te(a.$$.fragment,J),J.forEach(m),c=Z(pe),u=S(pe,"DIV",{class:!0});var ue=z(u);te(d.$$.fragment,ue),ue.forEach(m),h=Z(pe),p=S(pe,"DIV",{class:!0,tabindex:!0}),z(p).forEach(m),k=Z(pe),f=S(pe,"DIV",{class:!0});var B=z(f);te(b.$$.fragment,B),B.forEach(m),G=Z(pe),C=S(pe,"DIV",{class:!0});var ne=z(C);te(H.$$.fragment,ne),ne.forEach(m),N=Z(pe),w=S(pe,"DIV",{class:!0});var Ee=z(w);te(O.$$.fragment,Ee),Ee.forEach(m),M=Z(pe),L=S(pe,"DIV",{class:!0});var Ne=z(L);te(Y.$$.fragment,Ne),Ne.forEach(m),j=Z(pe),re&&re.l(pe),pe.forEach(m),P=Z(he),D=S(he,"DIV",{class:!0});var be=z(D);te(I.$$.fragment,be),be.forEach(m),he.forEach(m),this.h()},h(){g(t,"class","transform svelte-xuj13w"),g(o,"class","selected svelte-xuj13w"),g(u,"class","toolbar svelte-xuj13w"),g(p,"class","canvas svelte-xuj13w"),g(p,"tabindex","0"),g(f,"class","resizer svelte-xuj13w"),g(C,"class","text-panel svelte-xuj13w"),g(w,"class","action-panel svelte-xuj13w"),g(L,"class","elements-panel svelte-xuj13w"),g(e,"data-exclude-drag-modal",""),g(e,"class","container svelte-xuj13w"),Re(e,"grid-template-columns",y),Re(e,"cursor",n[8]?"col-resize":"default"),g(D,"class","config-buttons"),g(s,"class","modal-layout svelte-xuj13w")},m(X,he){V(X,s,he),$(s,e),$(e,t),ie(l,t,null),$(e,i),$(e,o),ie(a,o,null),$(e,c),$(e,u),ie(d,u,null),$(e,h),$(e,p),n[21](p),$(e,k),$(e,f),ie(b,f,null),$(e,G),$(e,C),ie(H,C,null),$(e,N),$(e,w),ie(O,w,null),$(e,M),$(e,L),ie(Y,L,null),$(e,j),re&&re.m(e,null),n[25](e),$(s,P),$(s,D),ie(I,D,null),v=!0,A||(R=[ri(Ai.call(null,p)),x(p,"fd:resize",n[20])],A=!0)},p(X,he){const pe=he&9216?at(W,[he&1024&&rt(X[10]),he&8192&&{setAttribute:X[13]}]):{};!r&&he&512&&(r=!0,pe.showHelp=X[9],dt(()=>r=!1)),l.$set(pe);const ve=he&11264?at(ae,[he&1024&&rt(X[10]),he&8192&&{setAttribute:X[13]},he&2048&&{entityOptions:X[11]}]):{};a.$set(ve);const J={};he&4&&(J.konva=X[2]),d.$set(J);const ue={};he&32&&(ue.container=X[5]),!_&&he&256&&(_=!0,ue.resizing=X[8],dt(()=>_=!1)),!E&&he&128&&(E=!0,ue.panelsWidth=X[7],dt(()=>E=!1)),b.$set(ue);const B=he&9216?at(Ce,[he&1024&&rt(X[10]),he&8192&&{setAttribute:X[13]}]):{};H.$set(B);const ne=he&3072?at(Le,[he&1024&&rt(X[10]),he&2048&&{entityOptions:X[11]}]):{};O.$set(ne);const Ee=he&1024?at(Se,[rt(X[10])]):{};Y.$set(Ee),X[9]?re?(re.p(X,he),he&512&&U(re,1)):(re=ai(X),re.c(),U(re,1),re.m(e,null)):re&&(Be(),F(re,1,1,()=>{re=null}),ze()),he&128&&y!==(y=`3rem 1fr 0px ${X[7]}px`)&&Re(e,"grid-template-columns",y),he&256&&Re(e,"cursor",X[8]?"col-resize":"default");const Ne={};he&1&&(Ne.sel=X[0]),I.$set(Ne)},i(X){v||(U(l.$$.fragment,X),U(a.$$.fragment,X),U(d.$$.fragment,X),U(b.$$.fragment,X),U(H.$$.fragment,X),U(O.$$.fragment,X),U(Y.$$.fragment,X),U(re),U(I.$$.fragment,X),v=!0)},o(X){F(l.$$.fragment,X),F(a.$$.fragment,X),F(d.$$.fragment,X),F(b.$$.fragment,X),F(H.$$.fragment,X),F(O.$$.fragment,X),F(Y.$$.fragment,X),F(re),F(I.$$.fragment,X),v=!1},d(X){X&&m(s),se(l),se(a),se(d),n[21](null),se(b),se(H),se(O),se(Y),re&&re.d(),n[25](null),se(I),A=!1,Oe(R)}}}function Ms(n){let s,e=n[12]("picture_elements")+"",t;return{c(){s=T("h1"),t=Me(e),this.h()},l(l){s=S(l,"H1",{slot:!0});var r=z(s);t=De(r,e),r.forEach(m),this.h()},h(){g(s,"slot","title")},m(l,r){V(l,s,r),$(s,t)},p(l,r){r&4096&&e!==(e=l[12]("picture_elements")+"")&&Qe(t,e)},d(l){l&&m(s)}}}function Ds(n){let s,e,t,l;s=new xi({props:{konva:n[2]}});let r=n[1]&&ni(n);return{c(){ee(s.$$.fragment),e=K(),r&&r.c(),t=Ue()},l(i){te(s.$$.fragment,i),e=Z(i),r&&r.l(i),t=Ue()},m(i,o){ie(s,i,o),V(i,e,o),r&&r.m(i,o),V(i,t,o),l=!0},p(i,[o]){const a={};o&4&&(a.konva=i[2]),s.$set(a),i[1]?r?(r.p(i,o),o&2&&U(r,1)):(r=ni(i),r.c(),U(r,1),r.m(t.parentNode,t)):r&&(Be(),F(r,1,1,()=>{r=null}),ze())},i(i){l||(U(s.$$.fragment,i),U(r),l=!0)},o(i){F(s.$$.fragment,i),F(r),l=!1},d(i){i&&(m(e),m(t)),se(s,i),r&&r.d(i)}}}function Bs(n,s,e){let t,l,r,i,o,a,c,u,d;He(n,bi,D=>e(26,o=D)),He(n,Dt,D=>e(27,a=D)),He(n,Xe,D=>e(17,c=D)),He(n,kt,D=>e(18,u=D)),He(n,_i,D=>e(12,d=D));let{sel:h}=s,{isOpen:p}=s,{demo:k=void 0}=s,f,b,_,E,G,C=300,H=!1,N=!1;function w(D,I,v){const A=v.target;A&&f.updateAttr(D,I,A.value)}pt(async()=>{var D;jt&&_&&(e(2,f=new jt(_,{className:"Stage",attrs:{width:_==null?void 0:_.offsetWidth,height:_==null?void 0:_.offsetHeight,id:(D=h==null?void 0:h.id)==null?void 0:D.toString()},children:[{className:"Layer",children:k?k==null?void 0:k.elements:(h==null?void 0:h.elements)||[]}]})),_.focus())}),di(()=>{var D;e(0,h.elements=f.getElementsData(),h),(D=f==null?void 0:f.destroyEditor)==null||D.call(f),Dt.set(a),o()});function O(D){N=D,e(9,N)}const M=D=>{e(3,E=D.target.offsetWidth),e(4,G=D.target.offsetHeight)};function L(D){Ke[D?"unshift":"push"](()=>{_=D,e(6,_)})}function Y(D){H=D,e(8,H)}function j(D){C=D,e(7,C)}function y(D){N=D,e(9,N)}function P(D){Ke[D?"unshift":"push"](()=>{b=D,e(5,b)})}return n.$$set=D=>{"sel"in D&&e(0,h=D.sel),"isOpen"in D&&e(1,p=D.isOpen),"demo"in D&&e(14,k=D.demo)},n.$$.update=()=>{var D,I;n.$$.dirty&262144&&e(11,t=Object.keys(u||{}).sort((v,A)=>v.localeCompare(A))),n.$$.dirty&131072&&e(16,l=c==null?void 0:c.selectedShapes),n.$$.dirty&65536&&e(15,r=l==null?void 0:l[0]),n.$$.dirty&98308&&e(10,i={konva:f,selectedShapes:l,selectedShape:r}),n.$$.dirty&12&&E&&((D=f==null?void 0:f.stage)==null||D.width(E),f==null||f.updateGuidePos()),n.$$.dirty&20&&G&&((I=f==null?void 0:f.stage)==null||I.height(G),f==null||f.updateGuidePos())},[h,p,f,E,G,b,_,C,H,N,i,t,d,w,k,r,l,c,u,O,M,L,Y,j,y,P]}class Ws extends Ve{constructor(s){super(),Fe(this,s,Bs,Ds,Ge,{sel:0,isOpen:1,demo:14})}}export{Ws as default};
